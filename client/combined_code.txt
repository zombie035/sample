PROJECT CODE BUNDLE
Generated: 1/20/2026, 6:49:57 PM
Total Files: 49

============================================================



============================================================
FILE: bundle-code.js
============================================================

const fs = require('fs');
const path = require('path');

// Configuration
const OUTPUT_FILE = 'combined_code.txt';
const INCLUDE_EXTENSIONS = ['.js', '.ejs', '.css', '.json', '.env',".jsx",".ico",".html"];
const EXCLUDE_DIRS = ['node_modules', 'dist', 'build', '.git', '.vscode'];
const EXCLUDE_FILES = ['package-lock.json', 'yarn.lock', 'combined_code.txt'];

// Style for headers (you can customize these)
const HEADER_STYLE = {
  top: '='.repeat(60),
  bottom: '='.repeat(60)
};

function shouldIncludeFile(filePath) {
  const ext = path.extname(filePath);
  const fileName = path.basename(filePath);
  
  // Check extension
  if (!INCLUDE_EXTENSIONS.includes(ext)) {
    return false;
  }
  
  // Check excluded files
  if (EXCLUDE_FILES.includes(fileName)) {
    return false;
  }
  
  // Check if in excluded directory
  for (const excludeDir of EXCLUDE_DIRS) {
    if (filePath.includes(`${path.sep}${excludeDir}${path.sep}`) || 
        filePath.startsWith(`${excludeDir}${path.sep}`)) {
      return false;
    }
  }
  
  return true;
}

function processFile(filePath) {
  try {
    const relativePath = path.relative(process.cwd(), filePath);
    const content = fs.readFileSync(filePath, 'utf8');
    
    let output = '\n\n';
    output += `${HEADER_STYLE.top}\n`;
    output += `FILE: ${relativePath}\n`;
    output += `${HEADER_STYLE.bottom}\n\n`;
    output += content;
    
    return output;
  } catch (error) {
    console.error(`Error reading ${filePath}:`, error.message);
    return '';
  }
}

function findFiles(dir) {
  let files = [];
  
  try {
    const items = fs.readdirSync(dir);
    
    for (const item of items) {
      const fullPath = path.join(dir, item);
      
      try {
        const stat = fs.statSync(fullPath);
        
        if (stat.isDirectory()) {
          // Check if directory should be excluded
          const dirName = path.basename(fullPath);
          if (!EXCLUDE_DIRS.includes(dirName)) {
            files = files.concat(findFiles(fullPath));
          }
        } else if (shouldIncludeFile(fullPath)) {
          files.push(fullPath);
        }
      } catch (err) {
        console.warn(`Skipping ${fullPath}: ${err.message}`);
      }
    }
  } catch (error) {
    console.error(`Error reading directory ${dir}:`, error.message);
  }
  
  return files;
}

function bundleProject() {
  console.log('ðŸ“¦ Bundling project files...');
  console.log('Looking for extensions:', INCLUDE_EXTENSIONS.join(', '));
  console.log('Excluding directories:', EXCLUDE_DIRS.join(', '));
  
  // Find all files
  const allFiles = findFiles('.');
  console.log(`Found ${allFiles.length} files to bundle\n`);
  
  if (allFiles.length === 0) {
    console.log('âŒ No files found with specified extensions!');
    return;
  }
  
  // Create output file
  let combinedContent = `PROJECT CODE BUNDLE\n`;
  combinedContent += `Generated: ${new Date().toLocaleString()}\n`;
  combinedContent += `Total Files: ${allFiles.length}\n`;
  combinedContent += `\n${'='.repeat(60)}\n\n`;
  
  // Process each file
  allFiles.forEach((file, index) => {
    console.log(`Processing [${index + 1}/${allFiles.length}]: ${path.relative(process.cwd(), file)}`);
    combinedContent += processFile(file);
  });
  
  // Write to file
  fs.writeFileSync(OUTPUT_FILE, combinedContent, 'utf8');
  
  console.log(`\nâœ… Done! All code bundled into: ${OUTPUT_FILE}`);
  console.log(`ðŸ“ Total size: ${(combinedContent.length / 1024).toFixed(2)} KB`);
  
  // Show summary
  console.log('\nðŸ“‹ File Type Summary:');
  const summary = {};
  allFiles.forEach(file => {
    const ext = path.extname(file);
    summary[ext] = (summary[ext] || 0) + 1;
  });
  
  Object.entries(summary).forEach(([ext, count]) => {
    console.log(`  ${ext}: ${count} files`);
  });
}

// Run the script
bundleProject();

============================================================
FILE: package.json
============================================================

{
  "name": "bus-tracking-client",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "@testing-library/jest-dom": "^6.4.2",
    "@testing-library/react": "^14.1.2",
    "@testing-library/user-event": "^14.5.1",
    "axios": "^1.6.7",
    "chart.js": "^4.4.0",
    "leaflet": "^1.9.4",
    "react": "^18.2.0",
    "react-chartjs-2": "^5.2.0",
    "react-dom": "^18.2.0",
    "react-hook-form": "^7.48.2",
    "react-leaflet": "^4.2.1",
    "react-router-dom": "^6.21.1",
    "react-scripts": "5.0.1",
    "socket.io-client": "^4.7.3",
    "web-vitals": "^3.5.0"
  },
  "scripts": {
  "start": "set DISABLE_ESLINT_PLUGIN=true && react-scripts start",
  "build": "set DISABLE_ESLINT_PLUGIN=true && react-scripts build",
  "test": "react-scripts test",
  "eject": "react-scripts eject"
},
  "proxy": "http://localhost:5000",
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }
}

============================================================
FILE: public/favicon.ico
============================================================



============================================================
FILE: public/index.html
============================================================



============================================================
FILE: src/App.jsx
============================================================

// client/src/App.jsx
import React from 'react';
import { Routes, Route, Navigate } from 'react-router-dom';
import { AuthProvider } from './contexts/AuthContext';
import { SocketProvider } from './contexts/SocketContext';
import LoginPage from './pages/LoginPage';
import HomePage from './pages/HomePage';
import AdminDashboard from './pages/AdminPages';
import DriverDashboard from './pages/DriverPage';
import StudentDashboard from './pages/StudentPage';
import PrivateRoute from './components/Auth/PrivateRoute';

function App() {
  return (
    <AuthProvider>
      <SocketProvider>
        <Routes>
          {/* Public Routes */}
          <Route path="/login" element={<LoginPage />} />
          
          {/* Protected Routes */}
          <Route path="/" element={
            <PrivateRoute>
              <HomePage />
            </PrivateRoute>
          } />
          
          <Route path="/admin/*" element={
            <PrivateRoute allowedRoles={['admin']}>
              <AdminDashboard />
            </PrivateRoute>
          } />
          
          <Route path="/driver/*" element={
            <PrivateRoute allowedRoles={['driver']}>
              <DriverDashboard />
            </PrivateRoute>
          } />
          
          <Route path="/student/*" element={
            <PrivateRoute allowedRoles={['student']}>
              <StudentDashboard />
            </PrivateRoute>
          } />
          
          {/* Fallback */}
          <Route path="*" element={<Navigate to="/login" />} />
        </Routes>
      </SocketProvider>
    </AuthProvider>
  );
}

export default App;

============================================================
FILE: src/components/Admin/BusForm.jsx
============================================================

// client/src/components/Admin/BusForm.jsx
import React, { useState, useEffect } from 'react';
import { userService } from '../../services/userService';

const BusForm = ({ bus, onSuccess, onCancel }) => {
  const [loading, setLoading] = useState(false);
  const [drivers, setDrivers] = useState([]);
  const [formData, setFormData] = useState({
    busId: '',
    busNumber: '',
    routeName: '',
    capacity: 40,
    status: 'stopped',
    driverId: '',
    latitude: '',
    longitude: ''
  });
  const [errors, setErrors] = useState({});

  useEffect(() => {
    if (bus) {
      setFormData({
        busId: bus.busId || '',
        busNumber: bus.busNumber || '',
        routeName: bus.routeName || '',
        capacity: bus.capacity || 40,
        status: bus.status || 'stopped',
        driverId: bus.driverId?._id || bus.driverId || '',
        latitude: bus.latitude?.toString() || '',
        longitude: bus.longitude?.toString() || ''
      });
    }
    fetchAvailableDrivers();
  }, [bus]);

  const fetchAvailableDrivers = async () => {
    try {
      const response = await userService.getAvailableDrivers();
      if (response.success) {
        setDrivers(response.drivers || []);
      }
    } catch (error) {
      console.error('Error fetching drivers:', error);
    }
  };

  const validateForm = () => {
    const newErrors = {};
    
    if (!formData.busId.trim()) newErrors.busId = 'Bus ID is required';
    if (!formData.busNumber.trim()) newErrors.busNumber = 'Bus number is required';
    if (formData.capacity && (formData.capacity < 1 || formData.capacity > 100)) {
      newErrors.capacity = 'Capacity must be between 1 and 100';
    }
    
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!validateForm()) {
      return;
    }

    setLoading(true);
    try {
      const busData = {
        busId: formData.busId,
        busNumber: formData.busNumber,
        routeName: formData.routeName,
        capacity: parseInt(formData.capacity),
        status: formData.status,
        driverId: formData.driverId || undefined
      };

      // Only include location if provided
      if (formData.latitude && formData.longitude) {
        busData.latitude = parseFloat(formData.latitude);
        busData.longitude = parseFloat(formData.longitude);
      }

      // In a real app, you would call busService.createBus or busService.updateBus
      console.log('Bus data:', busData);
      
      // Simulate API call
      setTimeout(() => {
        onSuccess();
        setLoading(false);
      }, 1000);

    } catch (error) {
      console.error('Error saving bus:', error);
      setErrors({ submit: error.message || 'Failed to save bus' });
      setLoading(false);
    }
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
    
    // Clear error for this field
    if (errors[name]) {
      setErrors(prev => ({
        ...prev,
        [name]: ''
      }));
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      {errors.submit && (
        <div className="p-4 bg-red-50 border border-red-200 rounded-lg">
          <div className="flex items-center gap-2 text-red-700">
            <i className="fas fa-exclamation-circle"></i>
            <span>{errors.submit}</span>
          </div>
        </div>
      )}

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Bus ID *
          </label>
          <input
            type="text"
            name="busId"
            value={formData.busId}
            onChange={handleChange}
            className={`block w-full px-4 py-3 border ${
              errors.busId ? 'border-red-300' : 'border-gray-300'
            } rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500`}
            placeholder="BUS_01"
          />
          {errors.busId && (
            <p className="mt-1 text-sm text-red-600">{errors.busId}</p>
          )}
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Bus Number *
          </label>
          <input
            type="text"
            name="busNumber"
            value={formData.busNumber}
            onChange={handleChange}
            className={`block w-full px-4 py-3 border ${
              errors.busNumber ? 'border-red-300' : 'border-gray-300'
            } rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500`}
            placeholder="01"
          />
          {errors.busNumber && (
            <p className="mt-1 text-sm text-red-600">{errors.busNumber}</p>
          )}
        </div>
      </div>

      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          Route Name
        </label>
        <input
          type="text"
          name="routeName"
          value={formData.routeName}
          onChange={handleChange}
          className="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          placeholder="Main Campus Route"
        />
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Capacity
          </label>
          <input
            type="number"
            name="capacity"
            value={formData.capacity}
            onChange={handleChange}
            min="1"
            max="100"
            className={`block w-full px-4 py-3 border ${
              errors.capacity ? 'border-red-300' : 'border-gray-300'
            } rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500`}
          />
          {errors.capacity && (
            <p className="mt-1 text-sm text-red-600">{errors.capacity}</p>
          )}
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Status
          </label>
          <select
            name="status"
            value={formData.status}
            onChange={handleChange}
            className="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="moving">Moving</option>
            <option value="stopped">Stopped</option>
            <option value="delayed">Delayed</option>
            <option value="offline">Offline</option>
          </select>
        </div>
      </div>

      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          Assign Driver (Optional)
        </label>
        <select
          name="driverId"
          value={formData.driverId}
          onChange={handleChange}
          className="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
          <option value="">Select a driver (optional)</option>
          {drivers.map(driver => (
            <option key={driver._id} value={driver._id}>
              {driver.name} ({driver.email})
            </option>
          ))}
        </select>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Initial Latitude
          </label>
          <input
            type="number"
            step="any"
            name="latitude"
            value={formData.latitude}
            onChange={handleChange}
            className="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            placeholder="12.9716"
          />
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Initial Longitude
          </label>
          <input
            type="number"
            step="any"
            name="longitude"
            value={formData.longitude}
            onChange={handleChange}
            className="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            placeholder="77.5946"
          />
        </div>
      </div>

      <div className="flex items-center justify-end gap-4 pt-6 border-t border-gray-200">
        <button
          type="button"
          onClick={onCancel}
          className="px-6 py-3 border border-gray-300 rounded-lg font-semibold text-gray-700 hover:bg-gray-50 transition-colors"
        >
          Cancel
        </button>
        <button
          type="submit"
          disabled={loading}
          className="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
        >
          {loading ? (
            <>
              <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
              Saving...
            </>
          ) : (
            <>
              <i className="fas fa-save"></i>
              {bus ? 'Update Bus' : 'Create Bus'}
            </>
          )}
        </button>
      </div>
    </form>
  );
};

export default BusForm;

============================================================
FILE: src/components/Admin/BusManagement.jsx
============================================================

// client/src/components/Admin/BusManagement.jsx
import React, { useState, useEffect } from 'react';
import { busService } from '../../services/busService';
import { userService } from '../../services/userService';
import Modal from '../UI/Modal';
import BusForm from './BusForm';

const BusManagement = () => {
  const [buses, setBuses] = useState([]);
  const [loading, setLoading] = useState(true);
  const [search, setSearch] = useState('');
  const [statusFilter, setStatusFilter] = useState('all');
  const [showModal, setShowModal] = useState(false);
  const [editingBus, setEditingBus] = useState(null);
  const [locationModal, setLocationModal] = useState(false);
  const [selectedBus, setSelectedBus] = useState(null);
  const [locationData, setLocationData] = useState({
    latitude: '',
    longitude: '',
    speed: 30,
    status: 'moving'
  });

  useEffect(() => {
    fetchBuses();
  }, [search, statusFilter]);

  const fetchBuses = async () => {
    try {
      setLoading(true);
      const busesData = await busService.getAllBuses();
      setBuses(busesData || []);
    } catch (error) {
      console.error('Error fetching buses:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleAddBus = () => {
    setEditingBus(null);
    setShowModal(true);
  };

  const handleEditBus = (bus) => {
    setEditingBus(bus);
    setShowModal(true);
  };

  const handleDeleteBus = async (busId, busNumber) => {
    if (!window.confirm(`Are you sure you want to delete Bus ${busNumber}? All assigned students will be unassigned.`)) {
      return;
    }

    try {
      // In a real app, you would call busService.deleteBus(busId)
      // For now, we'll just remove from state
      setBuses(prev => prev.filter(b => b._id !== busId));
    } catch (error) {
      console.error('Error deleting bus:', error);
      alert('Failed to delete bus');
    }
  };

  const handleUpdateLocation = (bus) => {
    setSelectedBus(bus);
    setLocationData({
      latitude: bus.latitude || '',
      longitude: bus.longitude || '',
      speed: bus.speed || 30,
      status: bus.status || 'moving'
    });
    setLocationModal(true);
  };

  const handleSubmitLocation = async () => {
    if (!selectedBus) return;

    try {
      await busService.updateBusLocation(selectedBus._id, locationData);
      setLocationModal(false);
      fetchBuses(); // Refresh list
    } catch (error) {
      console.error('Error updating location:', error);
      alert('Failed to update location');
    }
  };

  const getStatusBadgeClass = (status) => {
    switch (status?.toLowerCase()) {
      case 'moving': return 'bg-green-100 text-green-800';
      case 'stopped': return 'bg-yellow-100 text-yellow-800';
      case 'delayed': return 'bg-red-100 text-red-800';
      case 'offline': return 'bg-gray-100 text-gray-800';
      default: return 'bg-gray-100 text-gray-800';
    }
  };

  const filteredBuses = buses.filter(bus => {
    const matchesSearch = !search || 
      bus.busNumber?.toLowerCase().includes(search.toLowerCase()) ||
      bus.routeName?.toLowerCase().includes(search.toLowerCase()) ||
      bus.driverName?.toLowerCase().includes(search.toLowerCase());
    
    const matchesStatus = statusFilter === 'all' || bus.status === statusFilter;
    
    return matchesSearch && matchesStatus;
  });

  return (
    <div>
      {/* Header */}
      <div className="mb-8">
        <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Bus Management</h1>
            <p className="text-gray-600 mt-2">
              Manage all buses in the tracking system
            </p>
          </div>
          
          <div className="flex items-center gap-4">
            <button
              onClick={handleAddBus}
              className="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-emerald-700 transition-all flex items-center gap-2"
            >
              <i className="fas fa-bus"></i>
              Add New Bus
            </button>
          </div>
        </div>
      </div>

      {/* Filters and Search */}
      <div className="bg-white rounded-xl shadow-lg border border-gray-200 p-6 mb-8">
        <div className="flex flex-col md:flex-row gap-4">
          <div className="flex-1">
            <div className="relative">
              <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i className="fas fa-search text-gray-400"></i>
              </div>
              <input
                type="text"
                placeholder="Search buses by number, route, or driver..."
                value={search}
                onChange={(e) => setSearch(e.target.value)}
                className="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              />
            </div>
          </div>
          
          <div className="w-full md:w-auto">
            <select
              value={statusFilter}
              onChange={(e) => setStatusFilter(e.target.value)}
              className="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            >
              <option value="all">All Status</option>
              <option value="moving">Moving</option>
              <option value="stopped">Stopped</option>
              <option value="delayed">Delayed</option>
              <option value="offline">Offline</option>
            </select>
          </div>
        </div>
      </div>

      {/* Buses Grid */}
      {loading ? (
        <div className="flex items-center justify-center h-64">
          <div className="text-center">
            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
            <p className="mt-4 text-gray-600">Loading buses...</p>
          </div>
        </div>
      ) : filteredBuses.length === 0 ? (
        <div className="flex flex-col items-center justify-center h-64 p-8">
          <div className="w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center mb-4">
            <i className="fas fa-bus-slash text-3xl text-gray-400"></i>
          </div>
          <h3 className="text-xl font-semibold text-gray-900 mb-2">No Buses Found</h3>
          <p className="text-gray-600 text-center">
            {search || statusFilter !== 'all' 
              ? 'No buses match your search criteria'
              : 'No buses in the system yet'}
          </p>
          {!search && statusFilter === 'all' && (
            <button
              onClick={handleAddBus}
              className="mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition-all"
            >
              Add Your First Bus
            </button>
          )}
        </div>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {filteredBuses.map((bus) => (
            <div key={bus._id} className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden hover:shadow-xl transition-shadow">
              {/* Bus Header */}
              <div className="p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-gray-200">
                <div className="flex items-center justify-between">
                  <div>
                    <h3 className="text-xl font-bold text-gray-900">Bus {bus.busNumber}</h3>
                    <p className="text-gray-600">{bus.routeName || 'No route specified'}</p>
                  </div>
                  <span className={`px-3 py-1 text-xs font-semibold rounded-full ${getStatusBadgeClass(bus.status)}`}>
                    {bus.status || 'Offline'}
                  </span>
                </div>
              </div>

              {/* Bus Details */}
              <div className="p-6">
                <div className="space-y-4">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-gray-500">Vehicle ID</p>
                      <p className="font-semibold">{bus.busId || '---'}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Capacity</p>
                      <p className="font-semibold">{bus.capacity || 40} seats</p>
                    </div>
                  </div>

                  <div>
                    <p className="text-sm text-gray-500 mb-2">Driver</p>
                    {bus.driverName ? (
                      <div className="flex items-center gap-3">
                        <div className="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
                          <i className="fas fa-user"></i>
                        </div>
                        <div>
                          <p className="font-semibold">{bus.driverName}</p>
                          <p className="text-sm text-gray-500">{bus.driverId?.email || ''}</p>
                        </div>
                      </div>
                    ) : (
                      <p className="text-gray-500 italic">No driver assigned</p>
                    )}
                  </div>

                  <div>
                    <p className="text-sm text-gray-500 mb-2">Assigned Students</p>
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-2">
                        <div className="w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center text-purple-600">
                          <i className="fas fa-user-graduate"></i>
                        </div>
                        <div>
                          <p className="font-semibold">{bus.students?.length || 0} students</p>
                        </div>
                      </div>
                      {bus.students?.length > 0 && (
                        <button className="text-sm text-blue-600 hover:text-blue-800">
                          View All
                        </button>
                      )}
                    </div>
                  </div>

                  {bus.latitude && bus.longitude && (
                    <div>
                      <p className="text-sm text-gray-500 mb-2">Current Location</p>
                      <div className="flex items-center gap-2 text-gray-700">
                        <i className="fas fa-map-marker-alt text-red-500"></i>
                        <span>{bus.latitude.toFixed(4)}, {bus.longitude.toFixed(4)}</span>
                      </div>
                    </div>
                  )}

                  <div>
                    <p className="text-sm text-gray-500 mb-2">Last Updated</p>
                    <p className="text-gray-700">
                      {bus.updatedAt ? new Date(bus.updatedAt).toLocaleString() : 'Never'}
                    </p>
                  </div>
                </div>

                {/* Action Buttons */}
                <div className="mt-6 grid grid-cols-2 gap-3">
                  <button
                    onClick={() => handleEditBus(bus)}
                    className="px-4 py-2 bg-blue-50 text-blue-700 rounded-lg font-medium hover:bg-blue-100 transition-colors flex items-center justify-center gap-2"
                  >
                    <i className="fas fa-edit"></i>
                    Edit
                  </button>
                  <button
                    onClick={() => handleUpdateLocation(bus)}
                    className="px-4 py-2 bg-green-50 text-green-700 rounded-lg font-medium hover:bg-green-100 transition-colors flex items-center justify-center gap-2"
                  >
                    <i className="fas fa-map-marker-alt"></i>
                    Location
                  </button>
                  <button
                    onClick={() => window.open(`/admin/monitor?bus=${bus._id}`, '_blank')}
                    className="px-4 py-2 bg-purple-50 text-purple-700 rounded-lg font-medium hover:bg-purple-100 transition-colors flex items-center justify-center gap-2"
                  >
                    <i className="fas fa-map"></i>
                    Monitor
                  </button>
                  <button
                    onClick={() => handleDeleteBus(bus._id, bus.busNumber)}
                    className="px-4 py-2 bg-red-50 text-red-700 rounded-lg font-medium hover:bg-red-100 transition-colors flex items-center justify-center gap-2"
                  >
                    <i className="fas fa-trash"></i>
                    Delete
                  </button>
                </div>
              </div>
            </div>
          ))}
        </div>
      )}

      {/* Bus Modal */}
      <Modal
        isOpen={showModal}
        onClose={() => setShowModal(false)}
        title={editingBus ? 'Edit Bus' : 'Add New Bus'}
      >
        <BusForm
          bus={editingBus}
          onSuccess={() => {
            setShowModal(false);
            fetchBuses();
          }}
          onCancel={() => setShowModal(false)}
        />
      </Modal>

      {/* Location Update Modal */}
      <Modal
        isOpen={locationModal}
        onClose={() => setLocationModal(false)}
        title="Update Bus Location"
      >
        <div className="space-y-6">
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Latitude *
              </label>
              <input
                type="number"
                step="any"
                value={locationData.latitude}
                onChange={(e) => setLocationData(prev => ({ ...prev, latitude: e.target.value }))}
                className="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="12.9716"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Longitude *
              </label>
              <input
                type="number"
                step="any"
                value={locationData.longitude}
                onChange={(e) => setLocationData(prev => ({ ...prev, longitude: e.target.value }))}
                className="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="77.5946"
              />
            </div>
          </div>

          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Speed (km/h)
              </label>
              <input
                type="number"
                value={locationData.speed}
                onChange={(e) => setLocationData(prev => ({ ...prev, speed: e.target.value }))}
                className="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                min="0"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Status
              </label>
              <select
                value={locationData.status}
                onChange={(e) => setLocationData(prev => ({ ...prev, status: e.target.value }))}
                className="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              >
                <option value="moving">Moving</option>
                <option value="stopped">Stopped</option>
                <option value="delayed">Delayed</option>
              </select>
            </div>
          </div>

          <div className="flex items-center justify-end gap-4 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={() => setLocationModal(false)}
              className="px-6 py-3 border border-gray-300 rounded-lg font-semibold text-gray-700 hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              onClick={handleSubmitLocation}
              className="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition-all flex items-center gap-2"
            >
              <i className="fas fa-save"></i>
              Update Location
            </button>
          </div>
        </div>
      </Modal>
    </div>
  );
};

export default BusManagement;

============================================================
FILE: src/components/Admin/Dashboard.jsx
============================================================

// client/src/components/Admin/Dashboard.jsx
import React, { useState, useEffect } from 'react';
import { userService } from '../../services/userService';
import { busService } from '../../services/busService';
import StatCard from '../UI/StatCard';
import RecentActivity from '../UI/RecentActivity';
import ChartComponent from '../UI/ChartComponent';

const AdminDashboard = () => {
  const [stats, setStats] = useState({
    totalUsers: 0,
    totalStudents: 0,
    totalDrivers: 0,
    totalAdmins: 0,
    totalBuses: 0,
    activeBuses: 0,
    inactiveBuses: 0
  });
  const [recentUsers, setRecentUsers] = useState([]);
  const [recentBuses, setRecentBuses] = useState([]);
  const [chartData, setChartData] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchDashboardData();
  }, []);

  const fetchDashboardData = async () => {
    try {
      setLoading(true);
      
      // Fetch users and buses
      const [usersResponse, busesResponse] = await Promise.all([
        userService.getAllUsers(),
        busService.getAllBuses()
      ]);

      const users = usersResponse?.users || [];
      const buses = busesResponse || [];

      // Calculate stats
      const totalUsers = users.length;
      const totalStudents = users.filter(u => u.role === 'student').length;
      const totalDrivers = users.filter(u => u.role === 'driver').length;
      const totalAdmins = users.filter(u => u.role === 'admin').length;
      const totalBuses = buses.length;
      
      // Active buses (updated in last 10 minutes)
      const tenMinutesAgo = new Date(Date.now() - 10 * 60 * 1000);
      const activeBuses = buses.filter(bus => 
        new Date(bus.updatedAt) >= tenMinutesAgo
      ).length;

      // Recent users (last 5)
      const recentUsers = users
        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
        .slice(0, 5)
        .map(user => ({
          ...user,
          date: new Date(user.createdAt).toLocaleDateString()
        }));

      // Recent buses (last 5)
      const recentBuses = buses
        .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))
        .slice(0, 5)
        .map(bus => ({
          ...bus,
          date: new Date(bus.updatedAt).toLocaleDateString()
        }));

      // Prepare chart data (mock data for now)
      const mockChartData = {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        datasets: [
          {
            label: 'Active Users',
            data: [65, 59, 80, 81, 56, 55, 40],
            backgroundColor: 'rgba(59, 130, 246, 0.2)',
            borderColor: 'rgb(59, 130, 246)',
            tension: 0.4
          },
          {
            label: 'Bus Updates',
            data: [28, 48, 40, 19, 86, 27, 90],
            backgroundColor: 'rgba(16, 185, 129, 0.2)',
            borderColor: 'rgb(16, 185, 129)',
            tension: 0.4
          }
        ]
      };

      setStats({
        totalUsers,
        totalStudents,
        totalDrivers,
        totalAdmins,
        totalBuses,
        activeBuses,
        inactiveBuses: totalBuses - activeBuses
      });
      setRecentUsers(recentUsers);
      setRecentBuses(recentBuses);
      setChartData(mockChartData);

    } catch (error) {
      console.error('Error fetching dashboard data:', error);
    } finally {
      setLoading(false);
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center h-64">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
          <p className="mt-4 text-gray-600">Loading dashboard data...</p>
        </div>
      </div>
    );
  }

  return (
    <div>
      {/* Header */}
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-gray-900">Admin Dashboard</h1>
        <p className="text-gray-600 mt-2">
          Overview of your bus tracking system
        </p>
      </div>

      {/* Stats Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <StatCard
          title="Total Users"
          value={stats.totalUsers}
          icon="fas fa-users"
          color="blue"
          trend="+12%"
        />
        <StatCard
          title="Students"
          value={stats.totalStudents}
          icon="fas fa-user-graduate"
          color="green"
          trend="+8%"
        />
        <StatCard
          title="Drivers"
          value={stats.totalDrivers}
          icon="fas fa-user-tie"
          color="orange"
          trend="+5%"
        />
        <StatCard
          title="Buses"
          value={stats.totalBuses}
          icon="fas fa-bus"
          color="purple"
          trend="+15%"
        />
      </div>

      {/* Chart */}
      <div className="bg-white rounded-xl shadow-lg border border-gray-200 p-6 mb-8">
        <div className="flex items-center justify-between mb-6">
          <h2 className="text-xl font-semibold text-gray-900">Weekly Activity</h2>
          <div className="flex items-center gap-4">
            <button className="px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-lg">
              Week
            </button>
            <button className="px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-lg">
              Month
            </button>
            <button className="px-4 py-2 text-sm font-medium bg-blue-50 text-blue-700 rounded-lg">
              Year
            </button>
          </div>
        </div>
        <div className="h-80">
          <ChartComponent data={chartData} type="line" />
        </div>
      </div>

      {/* Recent Activity */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <RecentActivity
          title="Recent Users"
          items={recentUsers}
          type="users"
          emptyMessage="No recent users"
          onViewAll={() => window.location.href = '/admin/users'}
        />
        <RecentActivity
          title="Recent Buses"
          items={recentBuses}
          type="buses"
          emptyMessage="No recent buses"
          onViewAll={() => window.location.href = '/admin/buses'}
        />
      </div>

      {/* Quick Stats */}
      <div className="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
        <div className="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-500">Active Buses</p>
              <p className="text-3xl font-bold text-gray-900">{stats.activeBuses}</p>
            </div>
            <div className="w-12 h-12 rounded-lg bg-green-100 flex items-center justify-center">
              <i className="fas fa-bus text-green-600 text-xl"></i>
            </div>
          </div>
          <div className="mt-4">
            <div className="flex items-center text-sm text-gray-600">
              <i className="fas fa-info-circle mr-2"></i>
              <span>Updated in last 10 minutes</span>
            </div>
          </div>
        </div>

        <div className="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-500">Inactive Buses</p>
              <p className="text-3xl font-bold text-gray-900">{stats.inactiveBuses}</p>
            </div>
            <div className="w-12 h-12 rounded-lg bg-red-100 flex items-center justify-center">
              <i className="fas fa-bus-slash text-red-600 text-xl"></i>
            </div>
          </div>
          <div className="mt-4">
            <div className="flex items-center text-sm text-gray-600">
              <i className="fas fa-exclamation-triangle mr-2"></i>
              <span>Not updated in 10+ minutes</span>
            </div>
          </div>
        </div>

        <div className="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-500">Admins</p>
              <p className="text-3xl font-bold text-gray-900">{stats.totalAdmins}</p>
            </div>
            <div className="w-12 h-12 rounded-lg bg-blue-100 flex items-center justify-center">
              <i className="fas fa-shield-alt text-blue-600 text-xl"></i>
            </div>
          </div>
          <div className="mt-4">
            <div className="flex items-center text-sm text-gray-600">
              <i className="fas fa-user-shield mr-2"></i>
              <span>System administrators</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default AdminDashboard;

============================================================
FILE: src/components/Admin/LiveMonitor.jsx
============================================================

// client/src/components/Admin/LiveMonitor.jsx
import React, { useState, useEffect, useCallback } from 'react';
import MapComponent from '../Common/MapComponent';
import { busService } from '../../services/busService';
import { useSocket } from '../../contexts/SocketContext';

const LiveMonitor = () => {
  const [buses, setBuses] = useState([]);
  const [loading, setLoading] = useState(true);
  const [selectedBus, setSelectedBus] = useState(null);
  const [statusFilter, setStatusFilter] = useState('all');
  const [showBusList, setShowBusList] = useState(true);
  const [autoRefresh, setAutoRefresh] = useState(true);
  const { socket } = useSocket();

  // Fetch initial bus data
  useEffect(() => {
    fetchBuses();
  }, []);

  // Setup socket listeners for real-time updates
  useEffect(() => {
    if (!socket) return;

    const handleBusUpdate = (data) => {
      setBuses(prev => prev.map(bus => 
        bus._id === data.busId 
          ? { ...bus, ...data, updatedAt: new Date() }
          : bus
      ));
    };

    socket.on('bus-update', handleBusUpdate);
    socket.on('bus-live-update', handleBusUpdate);

    return () => {
      socket.off('bus-update', handleBusUpdate);
      socket.off('bus-live-update', handleBusUpdate);
    };
  }, [socket]);

  // Auto-refresh every 10 seconds
  useEffect(() => {
    if (!autoRefresh) return;

    const interval = setInterval(() => {
      fetchBuses();
    }, 10000);

    return () => clearInterval(interval);
  }, [autoRefresh]);

  const fetchBuses = async () => {
    try {
      const busesData = await busService.getLiveBuses();
      setBuses(busesData || []);
    } catch (error) {
      console.error('Error fetching buses:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleRefresh = () => {
    setLoading(true);
    fetchBuses();
  };

  const handleBusClick = (bus) => {
    setSelectedBus(bus);
  };

  const handleUpdateLocation = async (busId, locationData) => {
    try {
      await busService.updateBusLocation(busId, locationData);
      fetchBuses();
    } catch (error) {
      console.error('Error updating location:', error);
    }
  };

  const getStatusColor = (status) => {
    switch (status?.toLowerCase()) {
      case 'moving': return '#10b981';
      case 'stopped': return '#f59e0b';
      case 'delayed': return '#ef4444';
      default: return '#94a3b8';
    }
  };

  const getStatusIcon = (status) => {
    switch (status?.toLowerCase()) {
      case 'moving': return 'fa-play';
      case 'stopped': return 'fa-pause';
      case 'delayed': return 'fa-exclamation-triangle';
      default: return 'fa-question-circle';
    }
  };

  const filteredBuses = buses.filter(bus => 
    statusFilter === 'all' || bus.status === statusFilter
  );

  // Prepare map markers
  const mapMarkers = filteredBuses
    .filter(bus => bus.latitude && bus.longitude)
    .map(bus => ({
      position: { lat: bus.latitude, lng: bus.longitude },
      iconHtml: `
        <div style="
          width: 50px;
          height: 50px;
          background: ${getStatusColor(bus.status)};
          border-radius: 50%;
          border: 3px solid white;
          box-shadow: 0 4px 15px rgba(0,0,0,0.2);
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-size: 1.2rem;
          cursor: pointer;
        " onclick="event.stopPropagation();">
          <i class="fas fa-bus"></i>
        </div>
      `,
      iconSize: [50, 50],
      iconAnchor: [25, 50],
      popup: `
        <div style="padding: 10px; min-width: 200px;">
          <strong>Bus ${bus.busNumber}</strong><br>
          Route: ${bus.routeName || 'N/A'}<br>
          Status: ${bus.status || 'Offline'}<br>
          Driver: ${bus.driverName || 'N/A'}<br>
          Students: ${bus.students?.length || 0}<br>
          <small>Updated: ${new Date(bus.updatedAt).toLocaleTimeString()}</small>
        </div>
      `,
      onClick: () => handleBusClick(bus)
    }));

  // Calculate center point for all buses
  const calculateMapCenter = () => {
    if (selectedBus?.latitude && selectedBus?.longitude) {
      return [selectedBus.latitude, selectedBus.longitude];
    }

    const validBuses = filteredBuses.filter(b => b.latitude && b.longitude);
    if (validBuses.length === 0) return [20.5937, 78.9629];

    const avgLat = validBuses.reduce((sum, bus) => sum + bus.latitude, 0) / validBuses.length;
    const avgLng = validBuses.reduce((sum, bus) => sum + bus.longitude, 0) / validBuses.length;
    
    return [avgLat, avgLng];
  };

  return (
    <div>
      {/* Header */}
      <div className="mb-8">
        <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Live Bus Monitor</h1>
            <p className="text-gray-600 mt-2">
              Real-time tracking of all active buses
            </p>
          </div>
          
          <div className="flex flex-wrap items-center gap-4">
            <div className="flex items-center gap-2">
              <div className="w-3 h-3 rounded-full bg-green-500 animate-pulse"></div>
              <span className="text-sm font-medium text-green-700">
                {buses.filter(b => b.status === 'moving').length} Active
              </span>
            </div>
            
            <button
              onClick={handleRefresh}
              disabled={loading}
              className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors flex items-center gap-2 disabled:opacity-50"
            >
              <i className={`fas fa-sync-alt ${loading ? 'animate-spin' : ''}`}></i>
              Refresh
            </button>
            
            <label className="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                checked={autoRefresh}
                onChange={(e) => setAutoRefresh(e.target.checked)}
                className="h-4 w-4 text-blue-600 rounded focus:ring-blue-500"
              />
              <span className="text-sm text-gray-700">Auto-refresh</span>
            </label>
          </div>
        </div>
      </div>

      {/* Main Content */}
      <div className="flex flex-col lg:flex-row gap-6 h-[calc(100vh-200px)]">
        {/* Map Container */}
        <div className="flex-1 relative">
          <div className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden h-full">
            <div className="p-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50">
              <div className="flex items-center justify-between">
                <h2 className="text-lg font-semibold text-gray-900">
                  Live Tracking Map
                </h2>
                <div className="flex items-center gap-4">
                  <select
                    value={statusFilter}
                    onChange={(e) => setStatusFilter(e.target.value)}
                    className="px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  >
                    <option value="all">All Buses</option>
                    <option value="moving">Moving Only</option>
                    <option value="stopped">Stopped Only</option>
                    <option value="delayed">Delayed Only</option>
                  </select>
                  
                  <button
                    onClick={() => setShowBusList(!showBusList)}
                    className="px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2"
                  >
                    <i className="fas fa-list"></i>
                    {showBusList ? 'Hide List' : 'Show List'}
                  </button>
                </div>
              </div>
            </div>
            
            <div className="h-[calc(100%-80px)] relative">
              {loading ? (
                <div className="absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 z-10">
                  <div className="text-center">
                    <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
                    <p className="mt-4 text-gray-600">Loading map data...</p>
                  </div>
                </div>
              ) : (
                <MapComponent
                  center={calculateMapCenter()}
                  zoom={selectedBus ? 15 : 13}
                  markers={mapMarkers}
                  interactive={true}
                  className="rounded-b-xl"
                />
              )}
              
              {/* Legend */}
              <div className="absolute bottom-4 left-4 bg-white rounded-lg shadow-lg p-4 z-20 border border-gray-200">
                <h4 className="font-medium text-gray-900 mb-2">Legend</h4>
                <div className="space-y-2">
                  <div className="flex items-center gap-2">
                    <div className="w-4 h-4 rounded-full bg-green-500"></div>
                    <span className="text-sm text-gray-700">Moving</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <div className="w-4 h-4 rounded-full bg-yellow-500"></div>
                    <span className="text-sm text-gray-700">Stopped</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <div className="w-4 h-4 rounded-full bg-red-500"></div>
                    <span className="text-sm text-gray-700">Delayed</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <div className="w-4 h-4 rounded-full bg-gray-400"></div>
                    <span className="text-sm text-gray-700">Offline</span>
                  </div>
                </div>
              </div>
              
              {/* Refresh Timer */}
              {autoRefresh && (
                <div className="absolute top-4 right-4 bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-medium z-20">
                  <i className="fas fa-clock mr-2"></i>
                  Auto-refresh: 10s
                </div>
              )}
            </div>
          </div>
        </div>

        {/* Bus List Sidebar */}
        {showBusList && (
          <div className="lg:w-96">
            <div className="bg-white rounded-xl shadow-lg border border-gray-200 h-full overflow-hidden">
              <div className="p-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50">
                <h2 className="text-lg font-semibold text-gray-900">
                  Bus List ({filteredBuses.length})
                </h2>
              </div>
              
              <div className="overflow-y-auto h-[calc(100%-80px)]">
                {filteredBuses.length === 0 ? (
                  <div className="p-8 text-center">
                    <i className="fas fa-bus-slash text-4xl text-gray-300 mb-4"></i>
                    <p className="text-gray-500">No buses found</p>
                  </div>
                ) : (
                  <div className="divide-y divide-gray-200">
                    {filteredBuses.map((bus) => (
                      <div
                        key={bus._id}
                        className={`p-4 hover:bg-gray-50 cursor-pointer transition-colors ${
                          selectedBus?._id === bus._id ? 'bg-blue-50 border-l-4 border-blue-500' : ''
                        }`}
                        onClick={() => handleBusClick(bus)}
                      >
                        <div className="flex items-start justify-between">
                          <div className="flex-1">
                            <div className="flex items-center gap-3 mb-2">
                              <div
                                className="w-10 h-10 rounded-lg flex items-center justify-center text-white"
                                style={{ background: getStatusColor(bus.status) }}
                              >
                                <i className={`fas ${getStatusIcon(bus.status)}`}></i>
                              </div>
                              <div>
                                <h3 className="font-semibold text-gray-900">
                                  Bus {bus.busNumber}
                                </h3>
                                <p className="text-sm text-gray-600">{bus.routeName || 'No route'}</p>
                              </div>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-2 text-sm">
                              <div className="flex items-center gap-1">
                                <i className="fas fa-user text-gray-400"></i>
                                <span>{bus.driverName || 'No driver'}</span>
                              </div>
                              <div className="flex items-center gap-1">
                                <i className="fas fa-users text-gray-400"></i>
                                <span>{bus.students?.length || 0} students</span>
                              </div>
                            </div>
                            
                            {bus.latitude && bus.longitude && (
                              <div className="mt-2 text-xs text-gray-500">
                                <i className="fas fa-map-marker-alt mr-1"></i>
                                {bus.latitude.toFixed(4)}, {bus.longitude.toFixed(4)}
                              </div>
                            )}
                          </div>
                          
                          <div className="text-right">
                            <span
                              className="px-2 py-1 text-xs font-semibold rounded-full"
                              style={{
                                background: getStatusColor(bus.status) + '20',
                                color: getStatusColor(bus.status)
                              }}
                            >
                              {bus.status || 'Offline'}
                            </span>
                            <div className="mt-2 text-xs text-gray-500">
                              {bus.updatedAt ? new Date(bus.updatedAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : 'Never'}
                            </div>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </div>
          </div>
        )}
      </div>

      {/* Selected Bus Details Panel */}
      {selectedBus && (
        <div className="mt-6">
          <div className="bg-white rounded-xl shadow-lg border border-gray-200">
            <div className="p-6">
              <div className="flex items-center justify-between mb-6">
                <div>
                  <h2 className="text-xl font-bold text-gray-900">
                    Bus {selectedBus.busNumber} Details
                  </h2>
                  <p className="text-gray-600">Currently {selectedBus.status}</p>
                </div>
                <button
                  onClick={() => setSelectedBus(null)}
                  className="text-gray-400 hover:text-gray-600"
                >
                  <i className="fas fa-times text-xl"></i>
                </button>
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                {/* Basic Info */}
                <div className="space-y-4">
                  <div>
                    <h3 className="text-sm font-medium text-gray-500 uppercase mb-2">
                      Basic Information
                    </h3>
                    <div className="space-y-3">
                      <div className="flex justify-between">
                        <span className="text-gray-600">Bus ID:</span>
                        <span className="font-medium">{selectedBus.busId || '---'}</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">Route:</span>
                        <span className="font-medium">{selectedBus.routeName || 'N/A'}</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">Capacity:</span>
                        <span className="font-medium">{selectedBus.capacity || 40} seats</span>
                      </div>
                    </div>
                  </div>
                  
                  <div>
                    <h3 className="text-sm font-medium text-gray-500 uppercase mb-2">
                      Driver Information
                    </h3>
                    {selectedBus.driverName ? (
                      <div className="space-y-3">
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
                            <i className="fas fa-user"></i>
                          </div>
                          <div>
                            <p className="font-medium">{selectedBus.driverName}</p>
                            <p className="text-sm text-gray-500">{selectedBus.driverId?.email || ''}</p>
                          </div>
                        </div>
                      </div>
                    ) : (
                      <p className="text-gray-500 italic">No driver assigned</p>
                    )}
                  </div>
                </div>
                
                {/* Location Info */}
                <div className="space-y-4">
                  <div>
                    <h3 className="text-sm font-medium text-gray-500 uppercase mb-2">
                      Location & Status
                    </h3>
                    <div className="space-y-3">
                      <div className="flex justify-between">
                        <span className="text-gray-600">Current Status:</span>
                        <span className="font-medium capitalize">{selectedBus.status || 'offline'}</span>
                      </div>
                      {selectedBus.latitude && selectedBus.longitude ? (
                        <>
                          <div className="flex justify-between">
                            <span className="text-gray-600">Latitude:</span>
                            <span className="font-medium">{selectedBus.latitude.toFixed(6)}</span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-600">Longitude:</span>
                            <span className="font-medium">{selectedBus.longitude.toFixed(6)}</span>
                          </div>
                          {selectedBus.speed && (
                            <div className="flex justify-between">
                              <span className="text-gray-600">Speed:</span>
                              <span className="font-medium">{selectedBus.speed} km/h</span>
                            </div>
                          )}
                        </>
                      ) : (
                        <p className="text-gray-500 italic">No location data</p>
                      )}
                      <div className="flex justify-between">
                        <span className="text-gray-600">Last Updated:</span>
                        <span className="font-medium">
                          {selectedBus.updatedAt ? new Date(selectedBus.updatedAt).toLocaleString() : 'Never'}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
                
                {/* Quick Actions */}
                <div className="space-y-4">
                  <div>
                    <h3 className="text-sm font-medium text-gray-500 uppercase mb-2">
                      Quick Actions
                    </h3>
                    <div className="space-y-3">
                      <button
                        onClick={() => window.open(`https://www.google.com/maps?q=${selectedBus.latitude},${selectedBus.longitude}`, '_blank')}
                        disabled={!selectedBus.latitude}
                        className="w-full px-4 py-2 bg-blue-50 text-blue-700 rounded-lg font-medium hover:bg-blue-100 transition-colors flex items-center justify-center gap-2 disabled:opacity-50"
                      >
                        <i className="fas fa-external-link-alt"></i>
                        Open in Google Maps
                      </button>
                      
                      <button
                        onClick={() => window.open(`tel:${selectedBus.driverId?.phone}`)}
                        disabled={!selectedBus.driverId?.phone}
                        className="w-full px-4 py-2 bg-green-50 text-green-700 rounded-lg font-medium hover:bg-green-100 transition-colors flex items-center justify-center gap-2 disabled:opacity-50"
                      >
                        <i className="fas fa-phone"></i>
                        Call Driver
                      </button>
                      
                      <button
                        onClick={() => navigator.clipboard.writeText(`Bus ${selectedBus.busNumber} - ${selectedBus.routeName || ''}`)}
                        className="w-full px-4 py-2 bg-purple-50 text-purple-700 rounded-lg font-medium hover:bg-purple-100 transition-colors flex items-center justify-center gap-2"
                      >
                        <i className="fas fa-copy"></i>
                        Copy Bus Info
                      </button>
                      
                      <button
                        onClick={() => window.open(`/admin/buses?edit=${selectedBus._id}`, '_blank')}
                        className="w-full px-4 py-2 bg-gray-50 text-gray-700 rounded-lg font-medium hover:bg-gray-100 transition-colors flex items-center justify-center gap-2"
                      >
                        <i className="fas fa-edit"></i>
                        Edit Bus Details
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default LiveMonitor;

============================================================
FILE: src/components/Admin/UserForm.jsx
============================================================

// client/src/components/Admin/UserForm.jsx
import React, { useState, useEffect } from 'react';
import { userService } from '../../services/userService';

const UserForm = ({ user, onSuccess, onCancel }) => {
  const [loading, setLoading] = useState(false);
  const [buses, setBuses] = useState([]);
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    password: '',
    confirmPassword: '',
    role: 'student',
    studentId: '',
    phone: '',
    busNumber: ''
  });
  const [errors, setErrors] = useState({});

  useEffect(() => {
    if (user) {
      setFormData({
        name: user.name || '',
        email: user.email || '',
        password: '',
        confirmPassword: '',
        role: user.role || 'student',
        studentId: user.studentId || '',
        phone: user.phone || '',
        busNumber: user.busAssigned?.busNumber || ''
      });
    }
    fetchAvailableBuses();
  }, [user]);

  const fetchAvailableBuses = async () => {
    try {
      const response = await userService.getAvailableBuses();
      if (response.success) {
        setBuses(response.buses || []);
      }
    } catch (error) {
      console.error('Error fetching buses:', error);
    }
  };

  const validateForm = () => {
    const newErrors = {};
    
    if (!formData.name.trim()) newErrors.name = 'Name is required';
    if (!formData.email.trim()) newErrors.email = 'Email is required';
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.email)) newErrors.email = 'Invalid email format';
    
    if (!user && !formData.password) {
      newErrors.password = 'Password is required';
    }
    
    if (formData.password && formData.password.length < 6) {
      newErrors.password = 'Password must be at least 6 characters';
    }
    
    if (formData.password !== formData.confirmPassword) {
      newErrors.confirmPassword = 'Passwords do not match';
    }
    
    if (formData.role === 'student' && !formData.studentId.trim()) {
      newErrors.studentId = 'Student ID is required';
    }
    
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!validateForm()) {
      return;
    }

    setLoading(true);
    try {
      const userData = {
        name: formData.name,
        email: formData.email,
        role: formData.role,
        phone: formData.phone,
        studentId: formData.studentId,
        busNumber: formData.busNumber
      };

      // Only include password if provided
      if (formData.password) {
        userData.password = formData.password;
      }

      let response;
      if (user) {
        response = await userService.updateUser(user._id, userData);
      } else {
        response = await userService.createUser(userData);
      }

      if (response.success) {
        onSuccess();
      } else {
        setErrors({ submit: response.message || 'An error occurred' });
      }
    } catch (error) {
      console.error('Error saving user:', error);
      setErrors({ submit: error.message || 'Failed to save user' });
    } finally {
      setLoading(false);
    }
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
    
    // Clear error for this field
    if (errors[name]) {
      setErrors(prev => ({
        ...prev,
        [name]: ''
      }));
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      {errors.submit && (
        <div className="p-4 bg-red-50 border border-red-200 rounded-lg">
          <div className="flex items-center gap-2 text-red-700">
            <i className="fas fa-exclamation-circle"></i>
            <span>{errors.submit}</span>
          </div>
        </div>
      )}

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Full Name *
          </label>
          <input
            type="text"
            name="name"
            value={formData.name}
            onChange={handleChange}
            className={`block w-full px-4 py-3 border ${
              errors.name ? 'border-red-300' : 'border-gray-300'
            } rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500`}
            placeholder="John Doe"
          />
          {errors.name && (
            <p className="mt-1 text-sm text-red-600">{errors.name}</p>
          )}
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Email Address *
          </label>
          <input
            type="email"
            name="email"
            value={formData.email}
            onChange={handleChange}
            className={`block w-full px-4 py-3 border ${
              errors.email ? 'border-red-300' : 'border-gray-300'
            } rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500`}
            placeholder="john@college.edu"
          />
          {errors.email && (
            <p className="mt-1 text-sm text-red-600">{errors.email}</p>
          )}
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Role *
          </label>
          <select
            name="role"
            value={formData.role}
            onChange={handleChange}
            className="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="student">Student</option>
            <option value="driver">Driver</option>
            <option value="admin">Admin</option>
          </select>
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Phone Number
          </label>
          <input
            type="tel"
            name="phone"
            value={formData.phone}
            onChange={handleChange}
            className="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            placeholder="+1234567890"
          />
        </div>
      </div>

      {formData.role === 'student' && (
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Student ID *
          </label>
          <input
            type="text"
            name="studentId"
            value={formData.studentId}
            onChange={handleChange}
            className={`block w-full px-4 py-3 border ${
              errors.studentId ? 'border-red-300' : 'border-gray-300'
            } rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500`}
            placeholder="STU001"
          />
          {errors.studentId && (
            <p className="mt-1 text-sm text-red-600">{errors.studentId}</p>
          )}
        </div>
      )}

      {(formData.role === 'student' || formData.role === 'driver') && (
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Assign to Bus
          </label>
          <select
            name="busNumber"
            value={formData.busNumber}
            onChange={handleChange}
            className="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="">Select a bus (optional)</option>
            {buses.map(bus => (
              <option key={bus._id} value={bus.busNumber}>
                Bus {bus.busNumber} - {bus.routeName || 'No route'}
              </option>
            ))}
          </select>
        </div>
      )}

      {!user && (
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Password *
            </label>
            <input
              type="password"
              name="password"
              value={formData.password}
              onChange={handleChange}
              className={`block w-full px-4 py-3 border ${
                errors.password ? 'border-red-300' : 'border-gray-300'
              } rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500`}
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
            />
            {errors.password && (
              <p className="mt-1 text-sm text-red-600">{errors.password}</p>
            )}
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Confirm Password *
            </label>
            <input
              type="password"
              name="confirmPassword"
              value={formData.confirmPassword}
              onChange={handleChange}
              className={`block w-full px-4 py-3 border ${
                errors.confirmPassword ? 'border-red-300' : 'border-gray-300'
              } rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500`}
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
            />
            {errors.confirmPassword && (
              <p className="mt-1 text-sm text-red-600">{errors.confirmPassword}</p>
            )}
          </div>
        </div>
      )}

      <div className="flex items-center justify-end gap-4 pt-6 border-t border-gray-200">
        <button
          type="button"
          onClick={onCancel}
          className="px-6 py-3 border border-gray-300 rounded-lg font-semibold text-gray-700 hover:bg-gray-50 transition-colors"
        >
          Cancel
        </button>
        <button
          type="submit"
          disabled={loading}
          className="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
        >
          {loading ? (
            <>
              <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
              Saving...
            </>
          ) : (
            <>
              <i className="fas fa-save"></i>
              {user ? 'Update User' : 'Create User'}
            </>
          )}
        </button>
      </div>
    </form>
  );
};

export default UserForm;

============================================================
FILE: src/components/Admin/UserManagement.jsx
============================================================

// client/src/components/Admin/UserManagement.jsx
import React, { useState, useEffect } from 'react';
import { userService } from '../../services/userService';
import Modal from '../UI/Modal';
import UserForm from './UserForm';

const UserManagement = () => {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [search, setSearch] = useState('');
  const [roleFilter, setRoleFilter] = useState('all');
  const [showModal, setShowModal] = useState(false);
  const [editingUser, setEditingUser] = useState(null);
  const [bulkSelected, setBulkSelected] = useState([]);

  useEffect(() => {
    fetchUsers();
  }, [search, roleFilter]);

  const fetchUsers = async () => {
    try {
      setLoading(true);
      const params = {};
      if (roleFilter !== 'all') params.role = roleFilter;
      if (search) params.search = search;
      
      const response = await userService.getAllUsers(params);
      setUsers(response.users || []);
    } catch (error) {
      console.error('Error fetching users:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleAddUser = () => {
    setEditingUser(null);
    setShowModal(true);
  };

  const handleEditUser = (user) => {
    setEditingUser(user);
    setShowModal(true);
  };

  const handleDeleteUser = async (userId, userName) => {
    if (!window.confirm(`Are you sure you want to delete user: ${userName}?`)) {
      return;
    }

    try {
      await userService.deleteUser(userId);
      fetchUsers(); // Refresh list
    } catch (error) {
      console.error('Error deleting user:', error);
      alert('Failed to delete user');
    }
  };

  const handleBulkSelect = (userId) => {
    setBulkSelected(prev => 
      prev.includes(userId) 
        ? prev.filter(id => id !== userId)
        : [...prev, userId]
    );
  };

  const handleBulkDelete = async () => {
    if (bulkSelected.length === 0) {
      alert('Please select users to delete');
      return;
    }

    if (!window.confirm(`Are you sure you want to delete ${bulkSelected.length} users?`)) {
      return;
    }

    try {
      // Delete in parallel
      await Promise.all(bulkSelected.map(id => userService.deleteUser(id)));
      setBulkSelected([]);
      fetchUsers();
    } catch (error) {
      console.error('Error in bulk delete:', error);
      alert('Failed to delete users');
    }
  };

  const getRoleBadgeClass = (role) => {
    switch (role) {
      case 'admin': return 'bg-purple-100 text-purple-800';
      case 'driver': return 'bg-amber-100 text-amber-800';
      case 'student': return 'bg-blue-100 text-blue-800';
      default: return 'bg-gray-100 text-gray-800';
    }
  };

  const filteredUsers = users.filter(user => {
    const matchesSearch = !search || 
      user.name?.toLowerCase().includes(search.toLowerCase()) ||
      user.email?.toLowerCase().includes(search.toLowerCase()) ||
      user.studentId?.toLowerCase().includes(search.toLowerCase());
    
    const matchesRole = roleFilter === 'all' || user.role === roleFilter;
    
    return matchesSearch && matchesRole;
  });

  return (
    <div>
      {/* Header */}
      <div className="mb-8">
        <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <h1 className="text-3xl font-bold text-gray-900">User Management</h1>
            <p className="text-gray-600 mt-2">
              Manage all system users (students, drivers, admins)
            </p>
          </div>
          
          <div className="flex items-center gap-4">
            <button
              onClick={handleAddUser}
              className="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-emerald-700 transition-all flex items-center gap-2"
            >
              <i className="fas fa-user-plus"></i>
              Add New User
            </button>
          </div>
        </div>
      </div>

      {/* Filters and Search */}
      <div className="bg-white rounded-xl shadow-lg border border-gray-200 p-6 mb-8">
        <div className="flex flex-col md:flex-row gap-4">
          <div className="flex-1">
            <div className="relative">
              <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i className="fas fa-search text-gray-400"></i>
              </div>
              <input
                type="text"
                placeholder="Search users by name, email, or ID..."
                value={search}
                onChange={(e) => setSearch(e.target.value)}
                className="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              />
            </div>
          </div>
          
          <div className="w-full md:w-auto">
            <select
              value={roleFilter}
              onChange={(e) => setRoleFilter(e.target.value)}
              className="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            >
              <option value="all">All Roles</option>
              <option value="student">Students</option>
              <option value="driver">Drivers</option>
              <option value="admin">Admins</option>
            </select>
          </div>
          
          {bulkSelected.length > 0 && (
            <button
              onClick={handleBulkDelete}
              className="px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg font-semibold hover:from-red-600 hover:to-red-700 transition-all flex items-center gap-2"
            >
              <i className="fas fa-trash"></i>
              Delete Selected ({bulkSelected.length})
            </button>
          )}
        </div>
      </div>

      {/* Users Table */}
      <div className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="flex items-center justify-center h-64">
            <div className="text-center">
              <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
              <p className="mt-4 text-gray-600">Loading users...</p>
            </div>
          </div>
        ) : filteredUsers.length === 0 ? (
          <div className="flex flex-col items-center justify-center h-64 p-8">
            <div className="w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center mb-4">
              <i className="fas fa-user-slash text-3xl text-gray-400"></i>
            </div>
            <h3 className="text-xl font-semibold text-gray-900 mb-2">No Users Found</h3>
            <p className="text-gray-600 text-center">
              {search || roleFilter !== 'all' 
                ? 'No users match your search criteria'
                : 'No users in the system yet'}
            </p>
            {!search && roleFilter === 'all' && (
              <button
                onClick={handleAddUser}
                className="mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition-all"
              >
                Add Your First User
              </button>
            )}
          </div>
        ) : (
          <div className="overflow-x-auto">
            <table className="min-w-full divide-y divide-gray-200">
              <thead className="bg-gray-50">
                <tr>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    <input
                      type="checkbox"
                      checked={bulkSelected.length === filteredUsers.length}
                      onChange={() => {
                        if (bulkSelected.length === filteredUsers.length) {
                          setBulkSelected([]);
                        } else {
                          setBulkSelected(filteredUsers.map(u => u._id));
                        }
                      }}
                      className="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                    />
                  </th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Name
                  </th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Email
                  </th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Role
                  </th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Student ID
                  </th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Phone
                  </th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Joined
                  </th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody className="bg-white divide-y divide-gray-200">
                {filteredUsers.map((user) => (
                  <tr key={user._id} className="hover:bg-gray-50">
                    <td className="px-6 py-4 whitespace-nowrap">
                      <input
                        type="checkbox"
                        checked={bulkSelected.includes(user._id)}
                        onChange={() => handleBulkSelect(user._id)}
                        className="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                      />
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap">
                      <div className="flex items-center">
                        <div className="flex-shrink-0 h-10 w-10">
                          <div className="h-10 w-10 rounded-full bg-gradient-to-r from-blue-500 to-blue-600 flex items-center justify-center text-white font-semibold">
                            {user.name?.charAt(0).toUpperCase()}
                          </div>
                        </div>
                        <div className="ml-4">
                          <div className="text-sm font-medium text-gray-900">{user.name}</div>
                        </div>
                      </div>
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap">
                      <div className="text-sm text-gray-900">{user.email}</div>
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap">
                      <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getRoleBadgeClass(user.role)}`}>
                        {user.role}
                      </span>
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      {user.studentId || 'N/A'}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      {user.phone || 'N/A'}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      {new Date(user.createdAt).toLocaleDateString()}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                      <div className="flex items-center gap-2">
                        <button
                          onClick={() => handleEditUser(user)}
                          className="text-blue-600 hover:text-blue-900"
                          title="Edit"
                        >
                          <i className="fas fa-edit"></i>
                        </button>
                        <button
                          onClick={() => handleDeleteUser(user._id, user.name)}
                          className="text-red-600 hover:text-red-900"
                          title="Delete"
                        >
                          <i className="fas fa-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {/* Pagination (simplified) */}
      {filteredUsers.length > 0 && (
        <div className="mt-6 flex items-center justify-between">
          <div className="text-sm text-gray-700">
            Showing <span className="font-medium">{filteredUsers.length}</span> users
          </div>
          <div className="flex gap-2">
            <button className="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50">
              Previous
            </button>
            <button className="px-4 py-2 bg-blue-600 border border-transparent rounded-lg text-sm font-medium text-white hover:bg-blue-700">
              1
            </button>
            <button className="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50">
              2
            </button>
            <button className="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50">
              Next
            </button>
          </div>
        </div>
      )}

      {/* User Modal */}
      <Modal
        isOpen={showModal}
        onClose={() => setShowModal(false)}
        title={editingUser ? 'Edit User' : 'Add New User'}
      >
        <UserForm
          user={editingUser}
          onSuccess={() => {
            setShowModal(false);
            fetchUsers();
          }}
          onCancel={() => setShowModal(false)}
        />
      </Modal>
    </div>
  );
};

export default UserManagement;

============================================================
FILE: src/components/Auth/Login.jsx
============================================================

// client/src/components/Auth/Login.jsx
import React, { useState } from 'react';
import { useAuth } from '../../contexts/AuthContext';
import { useNavigate } from 'react-router-dom';

const Login = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [rememberMe, setRememberMe] = useState(false);
  const [loading, setLoading] = useState(false);
  const [showPassword, setShowPassword] = useState(false);
  
  const { login, error } = useAuth();
  const navigate = useNavigate();

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);

    const result = await login(email, password);
    
    if (result.success) {
      // Redirect based on role
      switch (result.role) {
        case 'admin':
          navigate('/admin/dashboard');
          break;
        case 'driver':
          navigate('/driver/dashboard');
          break;
        case 'student':
          navigate('/student/dashboard');
          break;
        default:
          navigate('/');
      }
    }
    
    setLoading(false);
  };

  const handleTestAccount = async (type) => {
    setLoading(true);
    const testEmail = type === 'driver' ? 'driver@college.edu' : 'student@college.edu';
    const testPassword = type === 'driver' ? 'driver123' : 'student123';
    
    setEmail(testEmail);
    setPassword(testPassword);
    
    const result = await login(testEmail, testPassword);
    
    if (result.success) {
      navigate(`/${result.role}/dashboard`);
    }
    
    setLoading(false);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 flex items-center justify-center p-4">
      <div className="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden">
        {/* Header */}
        <div className="bg-gradient-to-r from-blue-600 to-indigo-600 p-8 text-center">
          <div className="inline-flex items-center justify-center w-16 h-16 bg-white rounded-xl mb-4">
            <svg className="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z" />
              <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1v-1h4v1a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H21a1 1 0 001-1V5a1 1 0 00-1-1H3z" />
            </svg>
          </div>
          <h1 className="text-2xl font-bold text-white">College Bus Tracker</h1>
          <p className="text-blue-100 mt-2">Sign in to access real-time tracking</p>
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit} className="p-8">
          {error && (
            <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-3">
              <svg className="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
              </svg>
              <span className="text-red-700 text-sm">{error}</span>
            </div>
          )}

          <div className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Institutional Email
              </label>
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg className="h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                  </svg>
                </div>
                <input
                  type="email"
                  required
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  className="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="name@college.edu"
                />
              </div>
            </div>

            <div>
              <div className="flex items-center justify-between mb-2">
                <label className="block text-sm font-medium text-gray-700">
                  Password
                </label>
              </div>
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg className="h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fillRule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clipRule="evenodd" />
                  </svg>
                </div>
                <input
                  type={showPassword ? "text" : "password"}
                  required
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute inset-y-0 right-0 pr-3 flex items-center"
                >
                  {showPassword ? (
                    <svg className="h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                      <path fillRule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clipRule="evenodd" />
                    </svg>
                  ) : (
                    <svg className="h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                      <path fillRule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clipRule="evenodd" />
                      <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z" />
                    </svg>
                  )}
                </button>
              </div>
            </div>

            <div className="flex items-center justify-between">
              <div className="flex items-center">
                <input
                  type="checkbox"
                  id="remember"
                  checked={rememberMe}
                  onChange={(e) => setRememberMe(e.target.checked)}
                  className="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                />
                <label htmlFor="remember" className="ml-2 block text-sm text-gray-700">
                  Stay signed in
                </label>
              </div>
            </div>

            <button
              type="submit"
              disabled={loading}
              className="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-medium hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
            >
              {loading ? (
                <>
                  <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                  Signing in...
                </>
              ) : (
                'Sign in to Dashboard'
              )}
            </button>
          </div>

          {/* Test Accounts */}
          <div className="mt-8 pt-8 border-t border-gray-200">
            <p className="text-center text-sm text-gray-600 mb-4">For testing purposes:</p>
            <div className="grid grid-cols-2 gap-3">
              <button
                type="button"
                onClick={() => handleTestAccount('driver')}
                disabled={loading}
                className="px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-lg text-sm font-medium hover:from-amber-600 hover:to-orange-600 disabled:opacity-50"
              >
                Driver Login
              </button>
              <button
                type="button"
                onClick={() => handleTestAccount('student')}
                disabled={loading}
                className="px-4 py-2 bg-gradient-to-r from-emerald-500 to-green-500 text-white rounded-lg text-sm font-medium hover:from-emerald-600 hover:to-green-600 disabled:opacity-50"
              >
                Student Login
              </button>
            </div>
          </div>
        </form>

        {/* Footer */}
        <div className="px-8 py-6 bg-gray-50 border-t border-gray-200">
          <p className="text-center text-xs text-gray-600">
            Support contact: <a href="mailto:support@college.edu" className="text-blue-600 hover:text-blue-800">AIDS Department</a>
          </p>
          <p className="text-center text-xs text-gray-400 mt-2">
            SECURE GATEWAY
          </p>
        </div>
      </div>
    </div>
  );
};

export default Login;

============================================================
FILE: src/components/Auth/PrivateRoute.jsx
============================================================

// client/src/components/Auth/PrivateRoute.jsx
import React from 'react';
import { Navigate } from 'react-router-dom';
import { useAuth } from '../../contexts/AuthContext';

const PrivateRoute = ({ children, allowedRoles = [] }) => {
  const { user, loading } = useAuth();

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  if (!user) {
    return <Navigate to="/login" />;
  }

  // Check if user has required role
  if (allowedRoles.length > 0 && !allowedRoles.includes(user.role)) {
    // Redirect to appropriate dashboard based on role
    switch (user.role) {
      case 'admin':
        return <Navigate to="/admin/dashboard" />;
      case 'driver':
        return <Navigate to="/driver/dashboard" />;
      case 'student':
        return <Navigate to="/student/dashboard" />;
      default:
        return <Navigate to="/login" />;
    }
  }

  return children;
};

export default PrivateRoute;

============================================================
FILE: src/components/Auth/Register.jsx
============================================================



============================================================
FILE: src/components/Common/BusMarker.jsx
============================================================

// client/src/components/Common/BusMarker.jsx
import React from 'react';

const BusMarker = ({ bus, onClick, isActive = false }) => {
  const getStatusColor = (status) => {
    switch (status?.toLowerCase()) {
      case 'moving': return '#10b981';
      case 'stopped': return '#f59e0b';
      case 'delayed': return '#ef4444';
      case 'offline': return '#94a3b8';
      default: return '#94a3b8';
    }
  };

  const getStatusText = (status) => {
    switch (status?.toLowerCase()) {
      case 'moving': return 'Moving';
      case 'stopped': return 'Stopped';
      case 'delayed': return 'Delayed';
      default: return 'Offline';
    }
  };

  return (
    <div 
      className={`flex items-center gap-3 p-3 rounded-lg ${isActive ? 'bg-blue-50 border-2 border-blue-500' : 'bg-white border border-gray-200'} cursor-pointer hover:shadow-md transition-all`}
      onClick={() => onClick && onClick(bus)}
    >
      <div 
        className="w-12 h-12 rounded-lg flex items-center justify-center text-white font-bold text-lg"
        style={{ background: getStatusColor(bus.status) }}
      >
        <i className="fas fa-bus"></i>
      </div>
      
      <div className="flex-1">
        <div className="flex justify-between items-start">
          <div>
            <h3 className="font-semibold text-gray-900">Bus {bus.busNumber}</h3>
            <p className="text-sm text-gray-600">{bus.routeName || 'No route specified'}</p>
          </div>
          <span 
            className="px-2 py-1 text-xs font-medium rounded-full text-white"
            style={{ background: getStatusColor(bus.status) }}
          >
            {getStatusText(bus.status)}
          </span>
        </div>
        
        <div className="mt-2 grid grid-cols-2 gap-2 text-xs">
          <div className="flex items-center gap-1">
            <i className="fas fa-user text-gray-400"></i>
            <span className="text-gray-600">Driver:</span>
            <span className="font-medium">{bus.driverName || 'Unassigned'}</span>
          </div>
          <div className="flex items-center gap-1">
            <i className="fas fa-users text-gray-400"></i>
            <span className="text-gray-600">Students:</span>
            <span className="font-medium">{bus.students?.length || 0}</span>
          </div>
        </div>
        
        {bus.latitude && bus.longitude && (
          <div className="mt-2 text-xs text-gray-500">
            <i className="fas fa-map-marker-alt mr-1"></i>
            {bus.latitude.toFixed(4)}, {bus.longitude.toFixed(4)}
          </div>
        )}
      </div>
    </div>
  );
};

export default BusMarker;

============================================================
FILE: src/components/Common/LocationTracker.jsx
============================================================



============================================================
FILE: src/components/Common/MapComponent.jsx
============================================================

// client/src/components/Common/MapComponent.jsx
import React, { useEffect, useRef } from 'react';
import L from 'leaflet';
import 'leaflet/dist/leaflet.css';
import { useMap } from './MapProvider';

// Fix for default markers in Leaflet
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
  iconRetinaUrl: require('leaflet/dist/images/marker-icon-2x.png'),
  iconUrl: require('leaflet/dist/images/marker-icon.png'),
  shadowUrl: require('leaflet/dist/images/marker-shadow.png')
});

const MapComponent = ({ 
  center = [20.5937, 78.9629], 
  zoom = 13,
  markers = [],
  routes = [],
  onMapClick,
  interactive = true,
  className = ''
}) => {
  const mapRef = useRef(null);
  const mapInstanceRef = useRef(null);
  const markersRef = useRef([]);
  const routesRef = useRef([]);
  const { setMapInstance } = useMap();

  // Initialize map
  useEffect(() => {
    if (!mapRef.current) return;

    // Clean up existing map
    if (mapInstanceRef.current) {
      mapInstanceRef.current.remove();
    }

    // Create new map
    const map = L.map(mapRef.current, {
      center,
      zoom,
      zoomControl: false,
      dragging: interactive,
      scrollWheelZoom: interactive,
      doubleClickZoom: interactive,
      touchZoom: interactive
    });

    // Add tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors',
      maxZoom: 19
    }).addTo(map);

    // Add click handler
    if (onMapClick) {
      map.on('click', onMapClick);
    }

    mapInstanceRef.current = map;
    setMapInstance(map);

    // Cleanup on unmount
    return () => {
      if (mapInstanceRef.current) {
        mapInstanceRef.current.remove();
        mapInstanceRef.current = null;
      }
    };
  }, [center, zoom, interactive]);

  // Update markers
  useEffect(() => {
    if (!mapInstanceRef.current) return;

    // Clear existing markers
    markersRef.current.forEach(marker => marker.remove());
    markersRef.current = [];

    // Add new markers
    markers.forEach(markerData => {
      if (!markerData.position || !markerData.position.lat || !markerData.position.lng) {
        return;
      }

      let icon;
      if (markerData.iconHtml) {
        icon = L.divIcon({
          html: markerData.iconHtml,
          className: markerData.className || 'custom-marker',
          iconSize: markerData.iconSize || [40, 40],
          iconAnchor: markerData.iconAnchor || [20, 40]
        });
      } else {
        const color = markerData.color || '#3498db';
        const iconHtml = `
          <div style="
            width: ${markerData.size || 40}px;
            height: ${markerData.size || 40}px;
            background: ${color};
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: ${markerData.iconSize || 16}px;
          ">
            ${markerData.icon || 'ðŸ“'}
          </div>
        `;
        icon = L.divIcon({
          html: iconHtml,
          className: '',
          iconSize: [markerData.size || 40, markerData.size || 40],
          iconAnchor: [(markerData.size || 40) / 2, (markerData.size || 40)]
        });
      }

      const marker = L.marker([
        markerData.position.lat,
        markerData.position.lng
      ], { icon }).addTo(mapInstanceRef.current);

      if (markerData.popup) {
        marker.bindPopup(markerData.popup);
      }

      if (markerData.onClick) {
        marker.on('click', () => markerData.onClick(markerData));
      }

      markersRef.current.push(marker);
    });

    // Fit bounds if markers exist
    if (markers.length > 0 && mapInstanceRef.current) {
      const latLngs = markers
        .filter(m => m.position?.lat && m.position?.lng)
        .map(m => [m.position.lat, m.position.lng]);
      
      if (latLngs.length > 0) {
        const bounds = L.latLngBounds(latLngs);
        mapInstanceRef.current.fitBounds(bounds, { 
          padding: [50, 50],
          maxZoom: 15
        });
      }
    }
  }, [markers]);

  // Update routes
  useEffect(() => {
    if (!mapInstanceRef.current) return;

    // Clear existing routes
    routesRef.current.forEach(route => route.remove());
    routesRef.current = [];

    // Add new routes
    routes.forEach(routeData => {
      if (!routeData.coordinates || routeData.coordinates.length < 2) {
        return;
      }

      const polyline = L.polyline(
        routeData.coordinates.map(coord => [coord.lat, coord.lng]),
        {
          color: routeData.color || '#3498db',
          weight: routeData.weight || 4,
          opacity: routeData.opacity || 0.7,
          dashArray: routeData.dashed ? '10, 10' : undefined
        }
      ).addTo(mapInstanceRef.current);

      routesRef.current.push(polyline);
    });
  }, [routes]);

  // Update map center when props change
  useEffect(() => {
    if (mapInstanceRef.current && center) {
      mapInstanceRef.current.setView(center, zoom);
    }
  }, [center, zoom]);

  return (
    <div 
      ref={mapRef} 
      className={`w-full h-full ${className}`}
      style={{ minHeight: '400px' }}
    />
  );
};

export default MapComponent;

============================================================
FILE: src/components/Common/MapProvider.jsx
============================================================

// client/src/components/Common/MapProvider.jsx
import React, { createContext, useContext, useState } from 'react';

const MapContext = createContext({});

export const useMap = () => useContext(MapContext);

export const MapProvider = ({ children }) => {
  const [mapInstance, setMapInstance] = useState(null);

  const flyTo = (lat, lng, zoom = 15) => {
    if (mapInstance) {
      mapInstance.flyTo([lat, lng], zoom);
    }
  };

  const fitBounds = (latLngs) => {
    if (mapInstance && latLngs.length > 0) {
      const bounds = L.latLngBounds(latLngs);
      mapInstance.fitBounds(bounds, { padding: [50, 50] });
    }
  };

  const addMarker = (markerData) => {
    if (!mapInstance) return null;
    
    const marker = L.marker([markerData.lat, markerData.lng]);
    if (markerData.popup) {
      marker.bindPopup(markerData.popup);
    }
    marker.addTo(mapInstance);
    return marker;
  };

  const value = {
    mapInstance,
    setMapInstance,
    flyTo,
    fitBounds,
    addMarker
  };

  return (
    <MapContext.Provider value={value}>
      {children}
    </MapContext.Provider>
  );
};

============================================================
FILE: src/components/Driver/Dashboard.jsx
============================================================



============================================================
FILE: src/components/Layout/Footer.jsx
============================================================



============================================================
FILE: src/components/Layout/Navbar.jsx
============================================================

// client/src/components/Layout/Navbar.jsx
import React from 'react';
import { useAuth } from '../../contexts/AuthContext';
import { Link, useNavigate } from 'react-router-dom';

const Navbar = () => {
  const { user, logout } = useAuth();
  const navigate = useNavigate();

  const handleLogout = async () => {
    await logout();
    navigate('/login');
  };

  const getDashboardLink = () => {
    switch (user?.role) {
      case 'admin':
        return '/admin/dashboard';
      case 'driver':
        return '/driver/dashboard';
      case 'student':
        return '/student/dashboard';
      default:
        return '/';
    }
  };

  return (
    <nav className="bg-white shadow-sm border-b border-gray-200">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex justify-between h-16">
          <div className="flex items-center">
            <Link to={getDashboardLink()} className="flex items-center">
              <div className="flex-shrink-0">
                <div className="h-8 w-8 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center">
                  <svg className="h-5 w-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z" />
                    <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1v-1h4v1a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H21a1 1 0 001-1V5a1 1 0 00-1-1H3z" />
                  </svg>
                </div>
              </div>
              <div className="ml-3">
                <h1 className="text-lg font-semibold text-gray-900">BusTracker</h1>
                <p className="text-xs text-gray-500 capitalize">{user?.role || 'User'}</p>
              </div>
            </Link>
          </div>

          <div className="flex items-center space-x-4">
            {user && (
              <>
                <div className="hidden md:block">
                  <div className="flex items-center space-x-2">
                    <div className="w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-blue-600 flex items-center justify-center text-white font-medium">
                      {user.name?.charAt(0).toUpperCase()}
                    </div>
                    <div>
                      <p className="text-sm font-medium text-gray-700">{user.name}</p>
                      <p className="text-xs text-gray-500">{user.email}</p>
                    </div>
                  </div>
                </div>

                <button
                  onClick={handleLogout}
                  className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
                >
                  <svg className="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                  </svg>
                  Logout
                </button>
              </>
            )}
          </div>
        </div>
      </div>
    </nav>
  );
};

export default Navbar;

============================================================
FILE: src/components/Layout/Sidebar.jsx
============================================================



============================================================
FILE: src/components/Student/Dashboard.jsx
============================================================



============================================================
FILE: src/components/UI/Modal.jsx
============================================================

// client/src/components/UI/Modal.jsx
import React, { useEffect } from 'react';

const Modal = ({ isOpen, onClose, title, children, size = 'md' }) => {
  useEffect(() => {
    const handleEscape = (e) => {
      if (e.key === 'Escape') {
        onClose();
      }
    };

    if (isOpen) {
      document.addEventListener('keydown', handleEscape);
      document.body.style.overflow = 'hidden';
    }

    return () => {
      document.removeEventListener('keydown', handleEscape);
      document.body.style.overflow = 'unset';
    };
  }, [isOpen, onClose]);

  const getSizeClass = () => {
    switch (size) {
      case 'sm': return 'max-w-md';
      case 'lg': return 'max-w-2xl';
      case 'xl': return 'max-w-4xl';
      case 'full': return 'max-w-full mx-4';
      default: return 'max-w-lg';
    }
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 overflow-y-auto">
      {/* Backdrop */}
      <div 
        className="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
        onClick={onClose}
      />
      
      {/* Modal Container */}
      <div className="flex min-h-full items-center justify-center p-4">
        <div className={`relative bg-white rounded-xl shadow-xl w-full ${getSizeClass()} transform transition-all`}>
          {/* Header */}
          <div className="px-6 py-4 border-b border-gray-200">
            <div className="flex items-center justify-between">
              <h3 className="text-lg font-semibold text-gray-900">
                {title}
              </h3>
              <button
                onClick={onClose}
                className="text-gray-400 hover:text-gray-500 focus:outline-none"
              >
                <i className="fas fa-times text-xl"></i>
              </button>
            </div>
          </div>
          
          {/* Content */}
          <div className="px-6 py-4 max-h-[calc(100vh-200px)] overflow-y-auto">
            {children}
          </div>
        </div>
      </div>
    </div>
  );
};

export default Modal;

============================================================
FILE: src/components/UI/RecentActivity.jsx
============================================================

// client/src/components/UI/RecentActivity.jsx
import React from 'react';

const RecentActivity = ({ title, items, type, emptyMessage, onViewAll }) => {
  const getItemIcon = (item) => {
    switch (type) {
      case 'users':
        return (
          <div className="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-blue-600 flex items-center justify-center text-white font-semibold">
            {item.name?.charAt(0).toUpperCase() || 'U'}
          </div>
        );
      case 'buses':
        return (
          <div className="w-10 h-10 rounded-lg bg-gradient-to-r from-green-500 to-emerald-600 flex items-center justify-center text-white">
            <i className="fas fa-bus"></i>
          </div>
        );
      default:
        return (
          <div className="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center">
            <i className="fas fa-circle text-gray-400"></i>
          </div>
        );
    }
  };

  const getItemContent = (item) => {
    switch (type) {
      case 'users':
        return (
          <>
            <div className="flex-1 min-w-0">
              <p className="text-sm font-medium text-gray-900 truncate">
                {item.name}
              </p>
              <p className="text-sm text-gray-500 truncate">
                {item.email}
              </p>
              <div className="mt-1 flex items-center gap-2">
                <span className={`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${
                  item.role === 'admin' ? 'bg-purple-100 text-purple-800' :
                  item.role === 'driver' ? 'bg-amber-100 text-amber-800' :
                  'bg-blue-100 text-blue-800'
                }`}>
                  {item.role}
                </span>
                {item.studentId && (
                  <span className="text-xs text-gray-500">
                    ID: {item.studentId}
                  </span>
                )}
              </div>
            </div>
            <div className="text-right">
              <p className="text-xs text-gray-500">{item.date}</p>
            </div>
          </>
        );
      case 'buses':
        return (
          <>
            <div className="flex-1 min-w-0">
              <p className="text-sm font-medium text-gray-900 truncate">
                Bus {item.busNumber}
              </p>
              <p className="text-sm text-gray-500 truncate">
                {item.routeName || 'No route specified'}
              </p>
              <div className="mt-1 flex items-center gap-2">
                <span className={`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${
                  item.status === 'moving' ? 'bg-green-100 text-green-800' :
                  item.status === 'stopped' ? 'bg-yellow-100 text-yellow-800' :
                  item.status === 'delayed' ? 'bg-red-100 text-red-800' :
                  'bg-gray-100 text-gray-800'
                }`}>
                  {item.status || 'offline'}
                </span>
                <span className="text-xs text-gray-500">
                  {item.driverName || 'No driver'}
                </span>
              </div>
            </div>
            <div className="text-right">
              <p className="text-xs text-gray-500">{item.date}</p>
              {item.students?.length > 0 && (
                <p className="text-xs text-gray-500 mt-1">
                  {item.students.length} students
                </p>
              )}
            </div>
          </>
        );
      default:
        return null;
    }
  };

  return (
    <div className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
      <div className="p-6 border-b border-gray-200">
        <div className="flex items-center justify-between">
          <h2 className="text-lg font-semibold text-gray-900">{title}</h2>
          {onViewAll && (
            <button
              onClick={onViewAll}
              className="text-sm font-medium text-blue-600 hover:text-blue-800"
            >
              View all â†’
            </button>
          )}
        </div>
      </div>
      
      <div className="p-6">
        {items.length === 0 ? (
          <div className="text-center py-8">
            <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center">
              <i className="fas fa-inbox text-2xl text-gray-400"></i>
            </div>
            <p className="text-gray-500">{emptyMessage}</p>
          </div>
        ) : (
          <div className="space-y-4">
            {items.map((item, index) => (
              <div
                key={index}
                className="flex items-start gap-4 p-4 rounded-lg hover:bg-gray-50 transition-colors"
              >
                {getItemIcon(item)}
                {getItemContent(item)}
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
};

export default RecentActivity;

============================================================
FILE: src/components/UI/StatCard.jsx
============================================================

// client/src/components/UI/StatCard.jsx
import React from 'react';

const StatCard = ({ title, value, icon, color, trend, trendUp = true, loading = false }) => {
  const getColorClasses = () => {
    switch (color) {
      case 'blue':
        return 'from-blue-500 to-blue-600';
      case 'green':
        return 'from-green-500 to-emerald-600';
      case 'orange':
        return 'from-amber-500 to-orange-600';
      case 'purple':
        return 'from-purple-500 to-indigo-600';
      case 'red':
        return 'from-red-500 to-pink-600';
      default:
        return 'from-blue-500 to-blue-600';
    }
  };

  const getIconColor = () => {
    switch (color) {
      case 'blue': return 'text-blue-600';
      case 'green': return 'text-green-600';
      case 'orange': return 'text-amber-600';
      case 'purple': return 'text-purple-600';
      case 'red': return 'text-red-600';
      default: return 'text-blue-600';
    }
  };

  const getTrendColor = () => {
    if (!trend) return '';
    return trendUp ? 'text-green-600' : 'text-red-600';
  };

  return (
    <div className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden hover:shadow-xl transition-shadow">
      <div className="p-6">
        <div className="flex items-center justify-between">
          <div>
            <p className="text-sm font-medium text-gray-600 uppercase tracking-wide">
              {title}
            </p>
            {loading ? (
              <div className="h-10 mt-2">
                <div className="animate-pulse h-8 w-24 bg-gray-200 rounded"></div>
              </div>
            ) : (
              <p className="text-3xl font-bold text-gray-900 mt-2">
                {typeof value === 'number' ? value.toLocaleString() : value}
              </p>
            )}
            
            {trend && (
              <div className="flex items-center mt-2">
                <span className={`text-sm font-medium ${getTrendColor()}`}>
                  {trend}
                </span>
                <span className="text-sm text-gray-500 ml-2">from last month</span>
              </div>
            )}
          </div>
          
          <div className={`w-14 h-14 rounded-xl bg-gradient-to-r ${getColorClasses()} flex items-center justify-center`}>
            <i className={`${icon} text-2xl text-white`}></i>
          </div>
        </div>
        
        {loading ? (
          <div className="mt-4 h-2 bg-gray-200 rounded-full animate-pulse"></div>
        ) : (
          <div className="mt-6">
            <div className="flex items-center justify-between text-sm">
              <span className="text-gray-600">View details</span>
              <i className={`fas fa-arrow-right ${getIconColor()}`}></i>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default StatCard;

============================================================
FILE: src/components/UI/Toast.jsx
============================================================

// client/src/components/UI/Toast.jsx
import React, { useEffect } from 'react';

const Toast = ({ message, type = 'info', duration = 5000, onClose }) => {
  useEffect(() => {
    if (duration > 0) {
      const timer = setTimeout(() => {
        onClose();
      }, duration);

      return () => clearTimeout(timer);
    }
  }, [duration, onClose]);

  const getTypeStyles = () => {
    switch (type) {
      case 'success':
        return {
          bg: 'bg-green-50',
          border: 'border-green-200',
          text: 'text-green-800',
          icon: 'fa-check-circle',
          iconColor: 'text-green-500'
        };
      case 'error':
        return {
          bg: 'bg-red-50',
          border: 'border-red-200',
          text: 'text-red-800',
          icon: 'fa-exclamation-circle',
          iconColor: 'text-red-500'
        };
      case 'warning':
        return {
          bg: 'bg-yellow-50',
          border: 'border-yellow-200',
          text: 'text-yellow-800',
          icon: 'fa-exclamation-triangle',
          iconColor: 'text-yellow-500'
        };
      default:
        return {
          bg: 'bg-blue-50',
          border: 'border-blue-200',
          text: 'text-blue-800',
          icon: 'fa-info-circle',
          iconColor: 'text-blue-500'
        };
    }
  };

  const styles = getTypeStyles();

  return (
    <div className={`fixed top-4 right-4 z-50 ${styles.bg} border ${styles.border} rounded-lg shadow-lg max-w-md transform transition-all duration-300 animate-slide-in`}>
      <div className="p-4">
        <div className="flex items-start">
          <div className={`flex-shrink-0 ${styles.iconColor}`}>
            <i className={`fas ${styles.icon} text-lg`}></i>
          </div>
          <div className="ml-3 flex-1">
            <p className={`text-sm font-medium ${styles.text}`}>
              {message}
            </p>
          </div>
          <button
            onClick={onClose}
            className="ml-4 flex-shrink-0 text-gray-400 hover:text-gray-500 focus:outline-none"
          >
            <i className="fas fa-times"></i>
          </button>
        </div>
      </div>
      
      {/* Progress Bar */}
      {duration > 0 && (
        <div className="h-1 w-full bg-current bg-opacity-20">
          <div 
            className="h-full bg-current animate-progress"
            style={{ animationDuration: `${duration}ms` }}
          />
        </div>
      )}
    </div>
  );
};

export default Toast;

============================================================
FILE: src/contexts/AuthContext.jsx
============================================================

// client/src/contexts/AuthContext.jsx
import React, { createContext, useState, useContext, useEffect } from 'react';
import axios from 'axios';

const AuthContext = createContext({});

export const useAuth = () => useContext(AuthContext);

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');

  // Check authentication status on mount
  useEffect(() => {
    checkAuth();
  }, []);

  const checkAuth = async () => {
    try {
      const response = await axios.get('/api/auth/check', {
        withCredentials: true
      });
      
      if (response.data.authenticated) {
        setUser(response.data.user);
      }
    } catch (error) {
      console.error('Auth check failed:', error);
    } finally {
      setLoading(false);
    }
  };

  const login = async (email, password) => {
    setError('');
    try {
      const response = await axios.post('/api/auth/login', {
        email,
        password
      }, {
        withCredentials: true
      });

      if (response.data.success) {
        setUser(response.data.user);
        return { success: true, role: response.data.user.role };
      }
    } catch (error) {
      setError(error.response?.data?.message || 'Login failed');
      return { success: false, error: error.response?.data?.message };
    }
  };

  const logout = async () => {
    try {
      await axios.post('/api/auth/logout', {}, {
        withCredentials: true
      });
      setUser(null);
    } catch (error) {
      console.error('Logout failed:', error);
    }
  };

  const value = {
    user,
    loading,
    error,
    login,
    logout,
    checkAuth,
    isAuthenticated: !!user,
    isAdmin: user?.role === 'admin',
    isDriver: user?.role === 'driver',
    isStudent: user?.role === 'student'
  };

  return (
    <AuthContext.Provider value={value}>
      {children}
    </AuthContext.Provider>
  );
};

============================================================
FILE: src/contexts/SocketContext.jsx
============================================================

// client/src/contexts/SocketContext.jsx
import React, { createContext, useContext, useEffect, useState } from 'react';
import io from 'socket.io-client';
import { useAuth } from './AuthContext';

const SocketContext = createContext(null);

export const useSocket = () => useContext(SocketContext);

export const SocketProvider = ({ children }) => {
  const [socket, setSocket] = useState(null);
  const [connected, setConnected] = useState(false);
  const { user } = useAuth();

  useEffect(() => {
    if (!user) return;

    const newSocket = io(process.env.REACT_APP_API_URL || 'http://localhost:5000', {
      withCredentials: true,
      transports: ['websocket', 'polling']
    });

    newSocket.on('connect', () => {
      console.log('Socket connected');
      setConnected(true);
      
      // Join appropriate room based on user role
      if (user.role === 'driver') {
        newSocket.emit('join-driver-room', user.id);
      }
    });

    newSocket.on('disconnect', () => {
      console.log('Socket disconnected');
      setConnected(false);
    });

    newSocket.on('connect_error', (error) => {
      console.error('Socket connection error:', error);
    });

    setSocket(newSocket);

    return () => {
      newSocket.disconnect();
    };
  }, [user]);

  const joinBusRoom = (busId) => {
    if (socket && busId) {
      socket.emit('join-bus-room', busId);
    }
  };

  const sendLocationUpdate = (data) => {
    if (socket && connected) {
      socket.emit('driver-location-update', data);
    }
  };

  const value = {
    socket,
    connected,
    joinBusRoom,
    sendLocationUpdate
  };

  return (
    <SocketContext.Provider value={value}>
      {children}
    </SocketContext.Provider>
  );
};

============================================================
FILE: src/hooks/useAuth.js
============================================================



============================================================
FILE: src/hooks/useGeolocation.js
============================================================

// client/src/hooks/useGeolocation.js
import { useState, useEffect, useCallback } from 'react';

const useGeolocation = (options = {}) => {
  const [location, setLocation] = useState(null);
  const [error, setError] = useState(null);
  const [isTracking, setIsTracking] = useState(false);
  const [watchId, setWatchId] = useState(null);

  const defaultOptions = {
    enableHighAccuracy: true,
    timeout: 5000,
    maximumAge: 0,
    ...options
  };

  const getCurrentPosition = useCallback(() => {
    return new Promise((resolve, reject) => {
      if (!navigator.geolocation) {
        reject(new Error('Geolocation is not supported by your browser'));
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (position) => {
          const locationData = {
            latitude: position.coords.latitude,
            longitude: position.coords.longitude,
            accuracy: position.coords.accuracy,
            speed: position.coords.speed,
            heading: position.coords.heading,
            timestamp: position.timestamp
          };
          setLocation(locationData);
          resolve(locationData);
        },
        (error) => {
          const errorMsg = getErrorMessage(error);
          setError(errorMsg);
          reject(new Error(errorMsg));
        },
        defaultOptions
      );
    });
  }, []);

  const startTracking = useCallback((onLocationUpdate) => {
    if (!navigator.geolocation) {
      setError('Geolocation is not supported by your browser');
      return null;
    }

    if (isTracking) {
      console.warn('Geolocation is already being tracked');
      return watchId;
    }

    const id = navigator.geolocation.watchPosition(
      (position) => {
        const locationData = {
          latitude: position.coords.latitude,
          longitude: position.coords.longitude,
          accuracy: position.coords.accuracy,
          speed: position.coords.speed,
          heading: position.coords.heading,
          timestamp: position.timestamp
        };
        setLocation(locationData);
        if (onLocationUpdate) {
          onLocationUpdate(locationData);
        }
      },
      (error) => {
        setError(getErrorMessage(error));
      },
      defaultOptions
    );

    setWatchId(id);
    setIsTracking(true);
    return id;
  }, [isTracking, watchId]);

  const stopTracking = useCallback(() => {
    if (watchId) {
      navigator.geolocation.clearWatch(watchId);
      setWatchId(null);
      setIsTracking(false);
    }
  }, [watchId]);

  const getErrorMessage = (error) => {
    switch (error.code) {
      case error.PERMISSION_DENIED:
        return 'Location access denied. Please enable location services.';
      case error.POSITION_UNAVAILABLE:
        return 'Location information is unavailable.';
      case error.TIMEOUT:
        return 'Location request timed out.';
      default:
        return 'An unknown error occurred while getting location.';
    }
  };

  useEffect(() => {
    // Clean up on unmount
    return () => {
      if (watchId) {
        navigator.geolocation.clearWatch(watchId);
      }
    };
  }, [watchId]);

  return {
    location,
    error,
    isTracking,
    getCurrentPosition,
    startTracking,
    stopTracking,
    hasPermission: !!location || !error,
    isSupported: !!navigator.geolocation
  };
};

export default useGeolocation;

============================================================
FILE: src/hooks/useSocket.js
============================================================



============================================================
FILE: src/index.jsx
============================================================

// client/src/index.jsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import './styles/index.css';
import App from './App';
import { BrowserRouter } from 'react-router-dom';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </React.StrictMode>
);

============================================================
FILE: src/pages/AdminPages.jsx
============================================================

// client/src/pages/AdminPages.jsx
import React, { useState, useEffect } from 'react';
import { Routes, Route, Link, useLocation, Navigate } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';
import Navbar from '../components/Layout/Navbar';
import AdminDashboard from '../components/Admin/Dashboard';
import UserManagement from '../components/Admin/UserManagement';
import BusManagement from '../components/Admin/BusManagement';
import LiveMonitor from '../components/Admin/LiveMonitor';

const AdminPages = () => {
  const { user } = useAuth();
  const location = useLocation();
  
  // If not admin, redirect to appropriate dashboard
  if (user?.role !== 'admin') {
    return <Navigate to={`/${user?.role || ''}/dashboard`} />;
  }

  const navigation = [
    { name: 'Dashboard', href: '/admin/dashboard', icon: 'fas fa-tachometer-alt' },
    { name: 'Users', href: '/admin/users', icon: 'fas fa-users' },
    { name: 'Buses', href: '/admin/buses', icon: 'fas fa-bus' },
    { name: 'Live Monitor', href: '/admin/monitor', icon: 'fas fa-map-marked-alt' },
  ];

  return (
    <div className="min-h-screen bg-gray-50">
      <Navbar />
      
      <div className="flex">
        {/* Sidebar */}
        <div className="hidden md:flex md:w-64 md:flex-col md:fixed md:inset-y-0">
          <div className="flex-1 flex flex-col min-h-0 bg-white border-r border-gray-200">
            <div className="flex-1 flex flex-col pt-5 pb-4 overflow-y-auto">
              {/* Logo */}
              <div className="flex items-center flex-shrink-0 px-4">
                <div className="w-10 h-10 rounded-lg bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center">
                  <i className="fas fa-shield-alt text-white"></i>
                </div>
                <div className="ml-3">
                  <h2 className="text-lg font-semibold text-gray-900">Admin Panel</h2>
                  <p className="text-xs text-gray-500">Bus Tracking System</p>
                </div>
              </div>
              
              {/* Navigation */}
              <nav className="mt-8 flex-1 px-2 space-y-1">
                {navigation.map((item) => {
                  const isActive = location.pathname === item.href;
                  return (
                    <Link
                      key={item.name}
                      to={item.href}
                      className={`group flex items-center px-3 py-3 text-sm font-medium rounded-lg ${
                        isActive
                          ? 'bg-blue-50 text-blue-700 border-l-4 border-blue-600'
                          : 'text-gray-700 hover:bg-gray-50 hover:text-gray-900'
                      }`}
                    >
                      <i className={`${item.icon} mr-3 flex-shrink-0 ${
                        isActive ? 'text-blue-600' : 'text-gray-400 group-hover:text-gray-500'
                      }`}></i>
                      {item.name}
                    </Link>
                  );
                })}
              </nav>
            </div>
            
            {/* User Profile */}
            <div className="flex-shrink-0 flex border-t border-gray-200 p-4">
              <div className="flex items-center">
                <div className="ml-3">
                  <p className="text-sm font-medium text-gray-700">{user?.name}</p>
                  <p className="text-xs text-gray-500">{user?.email}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Main Content */}
        <div className="md:pl-64 flex flex-col flex-1">
          <main className="flex-1">
            <div className="py-6">
              <div className="max-w-7xl mx-auto px-4 sm:px-6 md:px-8">
                <Routes>
                  <Route path="dashboard" element={<AdminDashboard />} />
                  <Route path="users" element={<UserManagement />} />
                  <Route path="buses" element={<BusManagement />} />
                  <Route path="monitor" element={<LiveMonitor />} />
                  <Route path="*" element={<Navigate to="/admin/dashboard" />} />
                </Routes>
              </div>
            </div>
          </main>
        </div>
      </div>
    </div>
  );
};

export default AdminPages;

============================================================
FILE: src/pages/DriverPage.jsx
============================================================

// client/src/pages/DriverPage.jsx
import React, { useState, useEffect, useCallback } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { useSocket } from '../contexts/SocketContext';
import Navbar from '../components/Layout/Navbar';
import MapComponent from '../components/Common/MapComponent';
import useGeolocation from '../hooks/useGeolocation';
import { busService } from '../services/busService';
import { userService } from '../services/userService';

const DriverDashboard = () => {
  const { user } = useAuth();
  const { socket, connected, sendLocationUpdate } = useSocket();
  const { location, error: locationError, startTracking, stopTracking, isTracking } = useGeolocation();
  
  const [bus, setBus] = useState(null);
  const [loading, setLoading] = useState(true);
  const [isLive, setIsLive] = useState(false);
  const [speed, setSpeed] = useState(0);
  const [accuracy, setAccuracy] = useState(0);
  const [studentCount, setStudentCount] = useState(0);
  const [toast, setToast] = useState(null);

  // Fetch driver data and bus info
  useEffect(() => {
    const fetchData = async () => {
      try {
        setLoading(true);
        const [driverData, busData] = await Promise.all([
          userService.getStudentProfile(),
          busService.getMyBus()
        ]);
        
        if (driverData.success) {
          setBus(busData);
          setStudentCount(busData?.students?.length || 0);
        }
      } catch (error) {
        console.error('Error fetching driver data:', error);
        showToast('Failed to load dashboard data', 'error');
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, []);

  // Socket listeners
  useEffect(() => {
    if (!socket) return;

    const handleTrackingCount = (data) => {
      if (data.busId === bus?._id) {
        setStudentCount(data.count);
      }
    };

    socket.on('tracking-count', handleTrackingCount);

    return () => {
      socket.off('tracking-count', handleTrackingCount);
    };
  }, [socket, bus]);

  // Handle location updates
  const handleLocationUpdate = useCallback(async (locationData) => {
    if (!bus?._id) return;

    const speedKmh = locationData.speed ? (locationData.speed * 3.6).toFixed(1) : 0;
    setSpeed(speedKmh);
    setAccuracy(Math.round(locationData.accuracy));

    // Send to server
    try {
      const result = await busService.updateLocation({
        latitude: locationData.latitude,
        longitude: locationData.longitude,
        speed: speedKmh,
        accuracy: locationData.accuracy,
        status: 'moving'
      });

      if (result.success) {
        // Also send via socket for real-time updates
        sendLocationUpdate({
          busId: bus._id,
          latitude: locationData.latitude,
          longitude: locationData.longitude,
          speed: speedKmh,
          status: 'moving',
          timestamp: new Date()
        });
      }
    } catch (error) {
      console.error('Failed to update location:', error);
    }
  }, [bus, sendLocationUpdate]);

  // Start live tracking
  const startLiveTracking = async () => {
    if (!bus) {
      showToast('No bus assigned to you', 'error');
      return;
    }

    if (locationError) {
      showToast('Please enable location services', 'error');
      return;
    }

    try {
      const watchId = startTracking(handleLocationUpdate);
      if (watchId) {
        setIsLive(true);
        showToast('Live tracking started', 'success');
      }
    } catch (error) {
      showToast('Failed to start tracking', 'error');
    }
  };

  // Stop live tracking
  const stopLiveTracking = () => {
    stopTracking();
    setIsLive(false);
    
    // Update bus status to stopped
    if (bus?._id) {
      busService.updateLocation({
        updateStatusOnly: true,
        status: 'stopped'
      });
    }
    
    showToast('Live tracking stopped', 'info');
  };

  // Show toast notification
  const showToast = (message, type = 'info') => {
    setToast({ message, type });
    setTimeout(() => setToast(null), 3000);
  };

  // Map markers
  const mapMarkers = location ? [
    {
      position: { lat: location.latitude, lng: location.longitude },
      iconHtml: `
        <div style="
          width: 50px;
          height: 50px;
          background: #2563eb;
          border-radius: 50%;
          border: 3px solid white;
          box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-size: 1.2rem;
        ">
          <i class="fas fa-bus"></i>
        </div>
      `,
      iconSize: [50, 50],
      iconAnchor: [25, 50],
      popup: `
        <div style="padding: 10px; min-width: 200px;">
          <strong>Your Location</strong><br>
          Bus: ${bus?.busNumber || 'N/A'}<br>
          Speed: ${speed} km/h<br>
          Accuracy: ${accuracy}m
        </div>
      `
    }
  ] : [];

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
          <p className="mt-4 text-gray-600">Loading dashboard...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <Navbar />
      
      {/* Toast Notification */}
      {toast && (
        <div className={`fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg ${
          toast.type === 'success' ? 'bg-green-500' :
          toast.type === 'error' ? 'bg-red-500' :
          'bg-blue-500'
        } text-white transform transition-transform duration-300`}>
          <div className="flex items-center gap-3">
            <i className={`fas ${
              toast.type === 'success' ? 'fa-check-circle' :
              toast.type === 'error' ? 'fa-exclamation-circle' :
              'fa-info-circle'
            }`}></i>
            <span>{toast.message}</span>
          </div>
        </div>
      )}

      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Header */}
        <div className="mb-8">
          <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
              <h1 className="text-3xl font-bold text-gray-900">Driver Dashboard</h1>
              <p className="text-gray-600 mt-2">
                Welcome back, <span className="font-semibold">{user?.name}</span>
              </p>
            </div>
            
            <div className="flex items-center gap-4">
              <div className={`px-4 py-2 rounded-full flex items-center gap-2 ${
                connected ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
              }`}>
                <div className={`w-2 h-2 rounded-full ${connected ? 'bg-green-500' : 'bg-red-500'}`}></div>
                <span className="text-sm font-medium">
                  {connected ? 'Connected' : 'Disconnected'}
                </span>
              </div>
              
              <div className={`px-4 py-2 rounded-full flex items-center gap-2 ${
                isLive ? 'bg-purple-100 text-purple-800' : 'bg-gray-100 text-gray-800'
              }`}>
                <div className={`w-2 h-2 rounded-full animate-pulse ${isLive ? 'bg-purple-500' : 'bg-gray-500'}`}></div>
                <span className="text-sm font-medium">
                  {isLive ? 'LIVE' : 'OFFLINE'}
                </span>
              </div>
            </div>
          </div>
        </div>

        {/* Main Content */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* Left Column - Map */}
          <div className="lg:col-span-2">
            <div className="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
              <div className="p-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50">
                <div className="flex items-center justify-between">
                  <h2 className="text-lg font-semibold text-gray-900">
                    Live Location Tracking
                  </h2>
                  <div className="flex items-center gap-2">
                    {location && (
                      <span className="text-sm text-gray-600">
                        {location.latitude.toFixed(6)}, {location.longitude.toFixed(6)}
                      </span>
                    )}
                  </div>
                </div>
              </div>
              
              <div className="h-[500px] relative">
                <MapComponent
                  center={location ? [location.latitude, location.longitude] : [20.5937, 78.9629]}
                  zoom={location ? 15 : 13}
                  markers={mapMarkers}
                  interactive={true}
                />
                
                {locationError && (
                  <div className="absolute top-4 left-4 right-4 bg-red-50 border border-red-200 rounded-lg p-4 z-10">
                    <div className="flex items-center gap-3">
                      <i className="fas fa-exclamation-triangle text-red-500"></i>
                      <div>
                        <p className="text-red-700 font-medium">Location Error</p>
                        <p className="text-red-600 text-sm">{locationError}</p>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>

            {/* Control Buttons */}
            <div className="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
              <button
                onClick={isLive ? stopLiveTracking : startLiveTracking}
                disabled={!bus || locationError}
                className={`px-6 py-4 rounded-xl font-semibold text-lg transition-all flex items-center justify-center gap-3 ${
                  isLive 
                    ? 'bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white' 
                    : 'bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white'
                } disabled:opacity-50 disabled:cursor-not-allowed`}
              >
                <i className={`fas ${isLive ? 'fa-stop-circle' : 'fa-play-circle'}`}></i>
                {isLive ? 'Stop Live Tracking' : 'Start Live Tracking'}
              </button>
              
              <button
                onClick={() => location && window.open(`https://www.google.com/maps?q=${location.latitude},${location.longitude}`, '_blank')}
                disabled={!location}
                className="px-6 py-4 rounded-xl font-semibold text-lg bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white transition-all flex items-center justify-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <i className="fas fa-external-link-alt"></i>
                Open in Google Maps
              </button>
            </div>
          </div>

          {/* Right Column - Info & Stats */}
          <div className="space-y-6">
            {/* Bus Info Card */}
            <div className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
              <div className="p-6">
                <div className="flex items-center gap-4 mb-6">
                  <div className="w-16 h-16 rounded-xl bg-gradient-to-r from-blue-500 to-indigo-600 flex items-center justify-center text-white text-2xl">
                    <i className="fas fa-bus"></i>
                  </div>
                  <div>
                    <h3 className="text-xl font-bold text-gray-900">
                      Bus {bus?.busNumber || 'N/A'}
                    </h3>
                    <p className="text-gray-600">{bus?.routeName || 'No route assigned'}</p>
                  </div>
                </div>
                
                <div className="space-y-4">
                  <div className="grid grid-cols-2 gap-4">
                    <div className="bg-gray-50 p-4 rounded-lg">
                      <p className="text-sm text-gray-500 mb-1">Vehicle ID</p>
                      <p className="font-semibold">{bus?.busId || '---'}</p>
                    </div>
                    <div className="bg-gray-50 p-4 rounded-lg">
                      <p className="text-sm text-gray-500 mb-1">Capacity</p>
                      <p className="font-semibold">{bus?.capacity || 40} seats</p>
                    </div>
                  </div>
                  
                  <div className="bg-gray-50 p-4 rounded-lg">
                    <p className="text-sm text-gray-500 mb-1">Driver</p>
                    <p className="font-semibold">{bus?.driverName || user?.name}</p>
                  </div>
                  
                  <div className="bg-gray-50 p-4 rounded-lg">
                    <p className="text-sm text-gray-500 mb-1">Current Status</p>
                    <div className="flex items-center gap-2">
                      <div className={`w-3 h-3 rounded-full ${
                        isLive ? 'bg-green-500' : 'bg-red-500'
                      }`}></div>
                      <span className="font-semibold">{isLive ? 'ONLINE' : 'OFFLINE'}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {/* Telemetry Cards */}
            <div className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
              <div className="p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">Live Telemetry</h3>
                
                <div className="grid grid-cols-2 gap-4">
                  <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg">
                    <div className="flex items-center gap-3 mb-2">
                      <div className="w-10 h-10 rounded-lg bg-blue-500 flex items-center justify-center text-white">
                        <i className="fas fa-tachometer-alt"></i>
                      </div>
                      <div>
                        <p className="text-xs text-gray-600 uppercase font-semibold">Speed</p>
                        <p className="text-2xl font-bold text-gray-900">
                          {speed}
                          <span className="text-sm text-gray-600 ml-1">km/h</span>
                        </p>
                      </div>
                    </div>
                  </div>
                  
                  <div className="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg">
                    <div className="flex items-center gap-3 mb-2">
                      <div className="w-10 h-10 rounded-lg bg-green-500 flex items-center justify-center text-white">
                        <i className="fas fa-satellite"></i>
                      </div>
                      <div>
                        <p className="text-xs text-gray-600 uppercase font-semibold">GPS Accuracy</p>
                        <p className="text-2xl font-bold text-gray-900">
                          {accuracy}
                          <span className="text-sm text-gray-600 ml-1">m</span>
                        </p>
                      </div>
                    </div>
                  </div>
                  
                  <div className="bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg">
                    <div className="flex items-center gap-3 mb-2">
                      <div className="w-10 h-10 rounded-lg bg-purple-500 flex items-center justify-center text-white">
                        <i className="fas fa-user-graduate"></i>
                      </div>
                      <div>
                        <p className="text-xs text-gray-600 uppercase font-semibold">Active Trackers</p>
                        <p className="text-2xl font-bold text-gray-900">{studentCount}</p>
                      </div>
                    </div>
                  </div>
                  
                  <div className="bg-gradient-to-br from-amber-50 to-amber-100 p-4 rounded-lg">
                    <div className="flex items-center gap-3 mb-2">
                      <div className="w-10 h-10 rounded-lg bg-amber-500 flex items-center justify-center text-white">
                        <i className="fas fa-clock"></i>
                      </div>
                      <div>
                        <p className="text-xs text-gray-600 uppercase font-semibold">Uptime</p>
                        <p className="text-2xl font-bold text-gray-900">
                          {isLive ? 'Live' : '--:--'}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {/* Quick Actions */}
            <div className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
              <div className="p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h3>
                <div className="space-y-3">
                  <button 
                    onClick={() => window.location.reload()}
                    className="w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg text-left flex items-center gap-3 transition-colors"
                  >
                    <i className="fas fa-sync-alt text-gray-600"></i>
                    <span className="font-medium">Refresh Dashboard</span>
                  </button>
                  
                  <button 
                    onClick={() => showToast('Report feature coming soon!', 'info')}
                    className="w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg text-left flex items-center gap-3 transition-colors"
                  >
                    <i className="fas fa-flag text-red-600"></i>
                    <span className="font-medium">Report Issue</span>
                  </button>
                  
                  <button 
                    onClick={() => navigator.clipboard.writeText(`Bus ${bus?.busNumber} - ${bus?.routeName}`)}
                    className="w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg text-left flex items-center gap-3 transition-colors"
                  >
                    <i className="fas fa-copy text-blue-600"></i>
                    <span className="font-medium">Copy Bus Info</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default DriverDashboard;

============================================================
FILE: src/pages/HomePage.jsx
============================================================



============================================================
FILE: src/pages/LoginPage.jsx
============================================================

// client/src/pages/LoginPage.jsx
import React, { useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';
import Login from '../components/Auth/Login';

const LoginPage = () => {
  const { user } = useAuth();
  const navigate = useNavigate();

  useEffect(() => {
    if (user) {
      // Redirect to appropriate dashboard
      switch (user.role) {
        case 'admin':
          navigate('/admin/dashboard');
          break;
        case 'driver':
          navigate('/driver/dashboard');
          break;
        case 'student':
          navigate('/student/dashboard');
          break;
        default:
          navigate('/');
      }
    }
  }, [user, navigate]);

  return <Login />;
};

export default LoginPage;

============================================================
FILE: src/pages/StudentPage.jsx
============================================================

// client/src/pages/StudentPage.jsx
import React, { useState, useEffect } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { useSocket } from '../contexts/SocketContext';
import Navbar from '../components/Layout/Navbar';
import MapComponent from '../components/Common/MapComponent';
import BusMarker from '../components/Common/BusMarker';
import useGeolocation from '../hooks/useGeolocation';
import { busService } from '../services/busService';

const StudentDashboard = () => {
  const { user } = useAuth();
  const { socket, joinBusRoom } = useSocket();
  const { location, error: locationError, getCurrentPosition } = useGeolocation();
  
  const [bus, setBus] = useState(null);
  const [loading, setLoading] = useState(true);
  const [eta, setEta] = useState(null);
  const [distance, setDistance] = useState(null);
  const [showRoute, setShowRoute] = useState(false);
  const [routeCoordinates, setRouteCoordinates] = useState([]);
  const [lastUpdate, setLastUpdate] = useState(null);

  // Fetch student's bus
  useEffect(() => {
    const fetchBus = async () => {
      try {
        setLoading(true);
        const busData = await busService.getMyBus();
        
        if (busData) {
          setBus(busData);
          
          // Join bus room for real-time updates
          if (busData._id) {
            joinBusRoom(busData._id);
          }
        }
      } catch (error) {
        console.error('Error fetching bus data:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchBus();
  }, [joinBusRoom]);

  // Get student location on mount
  useEffect(() => {
    getCurrentPosition().catch(console.error);
  }, []);

  // Socket listeners for real-time updates
  useEffect(() => {
    if (!socket || !bus?._id) return;

    const handleBusUpdate = (data) => {
      setBus(prev => ({
        ...prev,
        latitude: data.latitude,
        longitude: data.longitude,
        status: data.status,
        updatedAt: data.timestamp
      }));
      setLastUpdate(new Date());
      
      // Recalculate ETA if student location is available
      if (location && data.latitude && data.longitude) {
        calculateETA(data.latitude, data.longitude);
      }
    };

    socket.on('bus-location-update', handleBusUpdate);
    socket.on('bus-live-update', handleBusUpdate);

    return () => {
      socket.off('bus-location-update', handleBusUpdate);
      socket.off('bus-live-update', handleBusUpdate);
    };
  }, [socket, bus?._id, location]);

  // Calculate ETA when locations change
  useEffect(() => {
    if (bus?.latitude && bus?.longitude && location) {
      calculateETA(bus.latitude, bus.longitude);
    }
  }, [bus, location]);

  // Calculate ETA and distance
  const calculateETA = async (busLat, busLng) => {
    if (!location) return;

    try {
      const routeInfo = await busService.getRouteInfo(
        location.latitude,
        location.longitude,
        busLat,
        busLng
      );

      if (routeInfo) {
        if (routeInfo.coordinates) {
          setRouteCoordinates(routeInfo.coordinates);
        }
        
        if (routeInfo.duration) {
          const minutes = Math.round(routeInfo.duration);
          setEta(minutes > 0 ? `${minutes} mins` : 'Arriving now');
        }
        
        if (routeInfo.distance) {
          setDistance(`${routeInfo.distance.toFixed(1)} km`);
        }
      }
    } catch (error) {
      // Fallback calculation using straight-line distance
      const straightLineDistance = calculateStraightDistance(
        location.latitude,
        location.longitude,
        busLat,
        busLng
      );
      
      const estimatedTime = Math.round((straightLineDistance / 30) * 60); // 30 km/h average
      setEta(estimatedTime > 0 ? `${estimatedTime} mins` : 'Arriving now');
      setDistance(`${straightLineDistance.toFixed(1)} km`);
    }
  };

  // Calculate straight-line distance (Haversine formula)
  const calculateStraightDistance = (lat1, lon1, lat2, lon2) => {
    const R = 6371; // Earth's radius in km
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = 
      Math.sin(dLat/2) * Math.sin(dLat/2) +
      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
      Math.sin(dLon/2) * Math.sin(dLon/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
  };

  // Map markers
  const mapMarkers = [
    ...(bus?.latitude && bus?.longitude ? [{
      position: { lat: bus.latitude, lng: bus.longitude },
      iconHtml: `
        <div style="
          width: 50px;
          height: 50px;
          background: #2563eb;
          border-radius: 50%;
          border: 3px solid white;
          box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-size: 1.2rem;
        ">
          <i class="fas fa-bus"></i>
        </div>
      `,
      iconSize: [50, 50],
      iconAnchor: [25, 50],
      popup: `
        <div style="padding: 10px; min-width: 200px;">
          <strong>Bus ${bus.busNumber}</strong><br>
          Route: ${bus.routeName || 'N/A'}<br>
          Status: ${bus.status || 'Active'}<br>
          Driver: ${bus.driverName || 'N/A'}
        </div>
      `
    }] : []),
    ...(location ? [{
      position: { lat: location.latitude, lng: location.longitude },
      color: '#10b981',
      size: 35,
      icon: 'ðŸ‘¨â€ðŸŽ“',
      popup: `
        <div style="padding: 10px;">
          <strong>Your Location</strong><br>
          ${location.latitude.toFixed(6)}, ${location.longitude.toFixed(6)}
        </div>
      `
    }] : [])
  ];

  // Route data for map
  const mapRoutes = showRoute && routeCoordinates.length > 0 ? [{
    coordinates: routeCoordinates,
    color: '#6366f1',
    weight: 4,
    opacity: 0.7
  }] : bus?.latitude && bus?.longitude && location ? [{
    coordinates: [
      { lat: location.latitude, lng: location.longitude },
      { lat: bus.latitude, lng: bus.longitude }
    ],
    color: '#94a3b8',
    weight: 3,
    opacity: 0.5,
    dashed: true
  }] : [];

  // Center map between bus and student
  const mapCenter = bus?.latitude && bus?.longitude && location 
    ? [
        (bus.latitude + location.latitude) / 2,
        (bus.longitude + location.longitude) / 2
      ]
    : bus?.latitude && bus?.longitude
    ? [bus.latitude, bus.longitude]
    : location
    ? [location.latitude, location.longitude]
    : [20.5937, 78.9629];

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
          <p className="mt-4 text-gray-600">Loading your bus information...</p>
        </div>
      </div>
    );
  }

  if (!bus) {
    return (
      <div className="min-h-screen bg-gray-50">
        <Navbar />
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <div className="bg-white rounded-xl shadow-lg border border-gray-200 p-8 text-center">
            <div className="w-20 h-20 mx-auto mb-6 rounded-full bg-gray-100 flex items-center justify-center">
              <i className="fas fa-bus-slash text-3xl text-gray-400"></i>
            </div>
            <h2 className="text-2xl font-bold text-gray-900 mb-4">No Bus Assigned</h2>
            <p className="text-gray-600 mb-6">
              You don't have a bus assigned to you yet. Please contact the AIDS Department for assistance.
            </p>
            <button
              onClick={() => window.location.reload()}
              className="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-medium hover:from-blue-600 hover:to-blue-700 transition-all"
            >
              <i className="fas fa-sync-alt mr-2"></i>
              Refresh Page
            </button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <Navbar />
      
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Header */}
        <div className="mb-8">
          <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
              <h1 className="text-3xl font-bold text-gray-900">Student Dashboard</h1>
              <p className="text-gray-600 mt-2">
                Track your bus in real-time
              </p>
            </div>
            
            <div className="flex items-center gap-4">
              <div className="px-4 py-2 bg-blue-50 border border-blue-200 rounded-full flex items-center gap-2">
                <div className="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></div>
                <span className="text-sm font-medium text-blue-800">
                  {bus.status?.toUpperCase() || 'TRACKING'}
                </span>
              </div>
              
              {lastUpdate && (
                <div className="text-sm text-gray-500">
                  Updated: {lastUpdate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                </div>
              )}
            </div>
          </div>
        </div>

        {/* Main Content */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* Left Column - Map */}
          <div className="lg:col-span-2">
            <div className="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
              <div className="p-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50">
                <div className="flex items-center justify-between">
                  <h2 className="text-lg font-semibold text-gray-900">
                    Live Bus Tracking
                  </h2>
                  <button
                    onClick={() => setShowRoute(!showRoute)}
                    className={`px-4 py-2 rounded-lg font-medium flex items-center gap-2 ${
                      showRoute 
                        ? 'bg-blue-500 text-white' 
                        : 'bg-white border border-gray-300 text-gray-700 hover:bg-gray-50'
                    }`}
                  >
                    <i className="fas fa-route"></i>
                    {showRoute ? 'Hide Route' : 'Show Route'}
                  </button>
                </div>
              </div>
              
              <div className="h-[500px] relative">
                <MapComponent
                  center={mapCenter}
                  zoom={13}
                  markers={mapMarkers}
                  routes={mapRoutes}
                  interactive={true}
                />
                
                {locationError && (
                  <div className="absolute top-4 left-4 right-4 bg-red-50 border border-red-200 rounded-lg p-4 z-10">
                    <div className="flex items-center gap-3">
                      <i className="fas fa-exclamation-triangle text-red-500"></i>
                      <div>
                        <p className="text-red-700 font-medium">Location Error</p>
                        <p className="text-red-600 text-sm">{locationError}</p>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>

            {/* Action Buttons */}
            <div className="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
              <button
                onClick={() => getCurrentPosition()}
                className="px-6 py-4 rounded-xl bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 hover:from-blue-100 hover:to-blue-200 transition-all flex items-center justify-center gap-3"
              >
                <i className="fas fa-location-crosshairs text-blue-600"></i>
                <span className="font-medium text-blue-700">Refresh Location</span>
              </button>
              
              <button
                onClick={() => window.open(`https://www.google.com/maps/dir/${location?.latitude},${location?.longitude}/${bus?.latitude},${bus?.longitude}`, '_blank')}
                disabled={!location || !bus?.latitude}
                className="px-6 py-4 rounded-xl bg-gradient-to-r from-green-50 to-green-100 border border-green-200 hover:from-green-100 hover:to-green-200 transition-all flex items-center justify-center gap-3 disabled:opacity-50"
              >
                <i className="fas fa-directions text-green-600"></i>
                <span className="font-medium text-green-700">Get Directions</span>
              </button>
              
              <button
                onClick={() => navigator.clipboard.writeText(`Bus ${bus.busNumber} - Driver: ${bus.driverName} - ${bus.routeName}`)}
                className="px-6 py-4 rounded-xl bg-gradient-to-r from-purple-50 to-purple-100 border border-purple-200 hover:from-purple-100 hover:to-purple-200 transition-all flex items-center justify-center gap-3"
              >
                <i className="fas fa-copy text-purple-600"></i>
                <span className="font-medium text-purple-700">Copy Bus Info</span>
              </button>
            </div>
          </div>

          {/* Right Column - Info & Details */}
          <div className="space-y-6">
            {/* ETA Card */}
            <div className="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl shadow-lg text-white overflow-hidden">
              <div className="p-6">
                <div className="flex items-center gap-3 mb-4">
                  <div className="w-12 h-12 rounded-lg bg-white/20 flex items-center justify-center">
                    <i className="fas fa-clock text-xl"></i>
                  </div>
                  <div>
                    <h3 className="text-lg font-semibold">Estimated Arrival</h3>
                    <p className="text-blue-100 text-sm">Based on current location</p>
                  </div>
                </div>
                
                <div className="text-center py-6">
                  <div className="text-5xl font-bold mb-2">{eta || '--:--'}</div>
                  <p className="text-blue-100">{distance || 'Calculating...'}</p>
                </div>
              </div>
            </div>

            {/* Bus Details */}
            <div className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
              <div className="p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">Bus Details</h3>
                
                <BusMarker bus={bus} isActive={true} />
                
                <div className="mt-6 space-y-4">
                  <div className="grid grid-cols-2 gap-4">
                    <div className="bg-gray-50 p-3 rounded-lg">
                      <p className="text-xs text-gray-500 uppercase font-semibold mb-1">Bus Number</p>
                      <p className="font-bold text-lg">{bus.busNumber}</p>
                    </div>
                    <div className="bg-gray-50 p-3 rounded-lg">
                      <p className="text-xs text-gray-500 uppercase font-semibold mb-1">Vehicle ID</p>
                      <p className="font-bold text-lg">{bus.busId || '---'}</p>
                    </div>
                  </div>
                  
                  <div className="bg-gray-50 p-3 rounded-lg">
                    <p className="text-xs text-gray-500 uppercase font-semibold mb-1">Route Name</p>
                    <p className="font-bold text-lg">{bus.routeName || 'Not specified'}</p>
                  </div>
                  
                  <div className="bg-gray-50 p-3 rounded-lg">
                    <p className="text-xs text-gray-500 uppercase font-semibold mb-1">Driver</p>
                    <div className="flex items-center justify-between">
                      <p className="font-bold text-lg">{bus.driverName || 'Unassigned'}</p>
                      {bus.driverId?.phone && (
                        <button
                          onClick={() => window.open(`tel:${bus.driverId.phone}`)}
                          className="px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-sm hover:bg-blue-200 transition-colors"
                        >
                          <i className="fas fa-phone mr-1"></i>
                          Call
                        </button>
                      )}
                    </div>
                  </div>
                  
                  {bus.driverId?.email && (
                    <div className="bg-gray-50 p-3 rounded-lg">
                      <p className="text-xs text-gray-500 uppercase font-semibold mb-1">Driver Email</p>
                      <a 
                        href={`mailto:${bus.driverId.email}`}
                        className="font-medium text-blue-600 hover:text-blue-800 flex items-center gap-2"
                      >
                        <i className="fas fa-envelope"></i>
                        {bus.driverId.email}
                      </a>
                    </div>
                  )}
                </div>
              </div>
            </div>

            {/* Quick Actions */}
            <div className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
              <div className="p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h3>
                <div className="space-y-3">
                  <button 
                    onClick={() => window.location.reload()}
                    className="w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg text-left flex items-center gap-3 transition-colors"
                  >
                    <i className="fas fa-sync-alt text-gray-600"></i>
                    <span className="font-medium">Refresh Dashboard</span>
                  </button>
                  
                  <button 
                    onClick={() => alert('Issue reported to AIDS Department. Thank you!')}
                    className="w-full px-4 py-3 bg-red-50 hover:bg-red-100 rounded-lg text-left flex items-center gap-3 transition-colors"
                  >
                    <i className="fas fa-flag text-red-600"></i>
                    <span className="font-medium text-red-700">Report Issue</span>
                  </button>
                  
                  <button 
                    onClick={() => navigator.share?.({
                      title: `Bus ${bus.busNumber} Tracking`,
                      text: `Track Bus ${bus.busNumber} on ${bus.routeName}. Current ETA: ${eta}`,
                      url: window.location.href
                    }).catch(console.error)}
                    className="w-full px-4 py-3 bg-green-50 hover:bg-green-100 rounded-lg text-left flex items-center gap-3 transition-colors"
                  >
                    <i className="fas fa-share-alt text-green-600"></i>
                    <span className="font-medium text-green-700">Share Tracking</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default StudentDashboard;

============================================================
FILE: src/routes.jsx
============================================================



============================================================
FILE: src/services/api.js
============================================================

// client/src/services/api.js
import axios from 'axios';

const api = axios.create({
  baseURL: process.env.REACT_APP_API_URL || 'http://localhost:5000',
  withCredentials: true,
  headers: {
    'Content-Type': 'application/json'
  }
});

// Request interceptor
api.interceptors.request.use(
  (config) => {
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// Response interceptor
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // Handle unauthorized access
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default api;

============================================================
FILE: src/services/auth.js
============================================================

// client/src/services/auth.js
import api from './api';

export const authService = {
  login: async (email, password) => {
    const response = await api.post('/api/auth/login', { email, password });
    return response.data;
  },

  logout: async () => {
    const response = await api.post('/api/auth/logout');
    return response.data;
  },

  checkAuth: async () => {
    const response = await api.get('/api/auth/check');
    return response.data;
  },

  createTestAccounts: async () => {
    const response = await api.post('/api/auth/create-test-accounts');
    return response.data;
  }
};

============================================================
FILE: src/services/busService.js
============================================================

// client/src/services/busService.js
import api from './api';

export const busService = {
  // Get all buses
  getAllBuses: async () => {
    const response = await api.get('/api/bus/location/all');
    return response.data;
  },

  // Get bus by ID
  getBus: async (busId) => {
    const response = await api.get(`/api/bus/location/${busId}`);
    return response.data;
  },

  // Get student's assigned bus
  getMyBus: async () => {
    const response = await api.get('/api/student/my-bus-location');
    return response.data;
  },

  // Get route info
  getRouteInfo: async (studentLat, studentLng, busLat, busLng) => {
    const response = await api.get('/api/student/route-info', {
      params: { studentLat, studentLng, busLat, busLng }
    });
    return response.data;
  },

  // Update bus location (driver)
  updateLocation: async (data) => {
    const response = await api.post('/api/driver/update-live-location', data);
    return response.data;
  },

  // Get live buses (admin)
  getLiveBuses: async () => {
    const response = await api.get('/api/admin/buses/live');
    return response.data;
  },

  // Update bus location (admin)
  updateBusLocation: async (busId, data) => {
    const response = await api.post(`/api/admin/buses/${busId}/location`, data);
    return response.data;
  }
};

============================================================
FILE: src/services/userService.js
============================================================

// client/src/services/userService.js
import api from './api';

export const userService = {
  // Admin: Get all users
  getAllUsers: async (params = {}) => {
    const response = await api.get('/api/admin/users', { params });
    return response.data;
  },

  // Admin: Get user by ID
  getUser: async (userId) => {
    const response = await api.get(`/api/admin/users/${userId}`);
    return response.data;
  },

  // Admin: Create user
  createUser: async (userData) => {
    const response = await api.post('/api/admin/users', userData);
    return response.data;
  },

  // Admin: Update user
  updateUser: async (userId, userData) => {
    const response = await api.put(`/api/admin/users/${userId}`, userData);
    return response.data;
  },

  // Admin: Delete user
  deleteUser: async (userId) => {
    const response = await api.delete(`/api/admin/users/${userId}`);
    return response.data;
  },

  // Admin: Get available drivers
  getAvailableDrivers: async () => {
    const response = await api.get('/api/admin/drivers');
    return response.data;
  },

  // Admin: Get available buses
  getAvailableBuses: async () => {
    const response = await api.get('/api/admin/buses');
    return response.data;
  },

  // Student: Get profile
  getStudentProfile: async () => {
    const response = await api.get('/api/student/profile');
    return response.data;
  }
};

============================================================
FILE: src/styles/admin.css
============================================================



============================================================
FILE: src/styles/components.css
============================================================



============================================================
FILE: src/styles/index.css
============================================================

/* client/src/styles/index.css */
:root {
  --primary: #1e293b;
  --primary-dark: #0f172a;
  --accent: #2563eb;
  --accent-light: #3b82f6;
  --success: #10b981;
  --danger: #ef4444;
  --warning: #f59e0b;
  --info: #06b6d4;
  --surface: #ffffff;
  --surface-dark: #1e293b;
  --bg: #f8fafc;
  --border: #e2e8f0;
  --text: #1e293b;
  --text-muted: #64748b;
  --radius: 8px;
  --radius-sm: 4px;
  --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background-color: var(--bg);
  color: var(--text);
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
    monospace;
}

/* Leaflet map fixes */
.leaflet-container {
  width: 100%;
  height: 100%;
  z-index: 1;
}

/* Utility classes */
.text-center { text-align: center; }
.text-right { text-align: right; }
.text-left { text-align: left; }
.mt-1 { margin-top: 0.25rem; }
.mt-2 { margin-top: 0.5rem; }
.mt-3 { margin-top: 1rem; }
.mt-4 { margin-top: 1.5rem; }
.mt-5 { margin-top: 2rem; }
.mb-1 { margin-bottom: 0.25rem; }
.mb-2 { margin-bottom: 0.5rem; }
.mb-3 { margin-bottom: 1rem; }
.mb-4 { margin-bottom: 1.5rem; }
.mb-5 { margin-bottom: 2rem; }
.p-1 { padding: 0.25rem; }
.p-2 { padding: 0.5rem; }
.p-3 { padding: 1rem; }
.p-4 { padding: 1.5rem; }
.p-5 { padding: 2rem; }
.d-flex { display: flex; }
.flex-column { flex-direction: column; }
.align-center { align-items: center; }
.justify-center { justify-content: center; }
.justify-between { justify-content: space-between; }
.gap-1 { gap: 0.25rem; }
.gap-2 { gap: 0.5rem; }
.gap-3 { gap: 1rem; }
.gap-4 { gap: 1.5rem; }
.w-100 { width: 100%; }
.h-100 { height: 100%; }

============================================================
FILE: src/utils/constants.js
============================================================



============================================================
FILE: src/utils/routeCalculator.js
============================================================



============================================================
FILE: src/utils/validators.js
============================================================

