{"ast":null,"code":"// client/src/components/Common/MapComponent.jsx\nimport React,{useEffect,useRef}from'react';import L from'leaflet';import'leaflet/dist/leaflet.css';import{useMap}from'./MapProvider';// Fix for default markers in Leaflet\nimport{jsx as _jsx}from\"react/jsx-runtime\";delete L.Icon.Default.prototype._getIconUrl;L.Icon.Default.mergeOptions({iconRetinaUrl:require('leaflet/dist/images/marker-icon-2x.png'),iconUrl:require('leaflet/dist/images/marker-icon.png'),shadowUrl:require('leaflet/dist/images/marker-shadow.png')});const MapComponent=_ref=>{let{center=[20.5937,78.9629],zoom=13,markers=[],routes=[],onMapClick,interactive=true,className=''}=_ref;const mapRef=useRef(null);const mapInstanceRef=useRef(null);const markersRef=useRef([]);const routesRef=useRef([]);const{setMapInstance}=useMap();// Initialize map\nuseEffect(()=>{if(!mapRef.current)return;// Clean up existing map\nif(mapInstanceRef.current){mapInstanceRef.current.remove();}// Create new map\nconst map=L.map(mapRef.current,{center,zoom,zoomControl:false,dragging:interactive,scrollWheelZoom:interactive,doubleClickZoom:interactive,touchZoom:interactive});// Add tile layer\nL.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap contributors',maxZoom:19}).addTo(map);// Add click handler\nif(onMapClick){map.on('click',onMapClick);}mapInstanceRef.current=map;setMapInstance(map);// Cleanup on unmount\nreturn()=>{if(mapInstanceRef.current){mapInstanceRef.current.remove();mapInstanceRef.current=null;}};},[center,zoom,interactive]);// Update markers\nuseEffect(()=>{if(!mapInstanceRef.current)return;// Clear existing markers\nmarkersRef.current.forEach(marker=>marker.remove());markersRef.current=[];// Add new markers\nmarkers.forEach(markerData=>{if(!markerData.position||!markerData.position.lat||!markerData.position.lng){return;}let icon;if(markerData.iconHtml){icon=L.divIcon({html:markerData.iconHtml,className:markerData.className||'custom-marker',iconSize:markerData.iconSize||[40,40],iconAnchor:markerData.iconAnchor||[20,40]});}else{const color=markerData.color||'#3498db';const iconHtml=\"\\n          <div style=\\\"\\n            width: \".concat(markerData.size||40,\"px;\\n            height: \").concat(markerData.size||40,\"px;\\n            background: \").concat(color,\";\\n            border-radius: 50%;\\n            border: 3px solid white;\\n            box-shadow: 0 2px 5px rgba(0,0,0,0.3);\\n            display: flex;\\n            align-items: center;\\n            justify-content: center;\\n            color: white;\\n            font-size: \").concat(markerData.iconSize||16,\"px;\\n          \\\">\\n            \").concat(markerData.icon||'üìç',\"\\n          </div>\\n        \");icon=L.divIcon({html:iconHtml,className:'',iconSize:[markerData.size||40,markerData.size||40],iconAnchor:[(markerData.size||40)/2,markerData.size||40]});}const marker=L.marker([markerData.position.lat,markerData.position.lng],{icon}).addTo(mapInstanceRef.current);if(markerData.popup){marker.bindPopup(markerData.popup);}if(markerData.onClick){marker.on('click',()=>markerData.onClick(markerData));}markersRef.current.push(marker);});// Fit bounds if markers exist\nif(markers.length>0&&mapInstanceRef.current){const latLngs=markers.filter(m=>{var _m$position,_m$position2;return((_m$position=m.position)===null||_m$position===void 0?void 0:_m$position.lat)&&((_m$position2=m.position)===null||_m$position2===void 0?void 0:_m$position2.lng);}).map(m=>[m.position.lat,m.position.lng]);if(latLngs.length>0){const bounds=L.latLngBounds(latLngs);mapInstanceRef.current.fitBounds(bounds,{padding:[50,50],maxZoom:15});}}},[markers]);// Update routes\nuseEffect(()=>{if(!mapInstanceRef.current)return;// Clear existing routes\nroutesRef.current.forEach(route=>route.remove());routesRef.current=[];// Add new routes\nroutes.forEach(routeData=>{if(!routeData.coordinates||routeData.coordinates.length<2){return;}const polyline=L.polyline(routeData.coordinates.map(coord=>[coord.lat,coord.lng]),{color:routeData.color||'#3498db',weight:routeData.weight||4,opacity:routeData.opacity||0.7,dashArray:routeData.dashed?'10, 10':undefined}).addTo(mapInstanceRef.current);routesRef.current.push(polyline);});},[routes]);// Update map center when props change\nuseEffect(()=>{if(mapInstanceRef.current&&center){mapInstanceRef.current.setView(center,zoom);}},[center,zoom]);return/*#__PURE__*/_jsx(\"div\",{ref:mapRef,className:\"w-full h-full \".concat(className),style:{minHeight:'400px'}});};export default MapComponent;","map":{"version":3,"names":["React","useEffect","useRef","L","useMap","jsx","_jsx","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","require","iconUrl","shadowUrl","MapComponent","_ref","center","zoom","markers","routes","onMapClick","interactive","className","mapRef","mapInstanceRef","markersRef","routesRef","setMapInstance","current","remove","map","zoomControl","dragging","scrollWheelZoom","doubleClickZoom","touchZoom","tileLayer","attribution","maxZoom","addTo","on","forEach","marker","markerData","position","lat","lng","icon","iconHtml","divIcon","html","iconSize","iconAnchor","color","concat","size","popup","bindPopup","onClick","push","length","latLngs","filter","m","_m$position","_m$position2","bounds","latLngBounds","fitBounds","padding","route","routeData","coordinates","polyline","coord","weight","opacity","dashArray","dashed","undefined","setView","ref","style","minHeight"],"sources":["/home/project/client/src/components/Common/MapComponent.jsx"],"sourcesContent":["// client/src/components/Common/MapComponent.jsx\nimport React, { useEffect, useRef } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport { useMap } from './MapProvider';\n\n// Fix for default markers in Leaflet\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: require('leaflet/dist/images/marker-icon-2x.png'),\n  iconUrl: require('leaflet/dist/images/marker-icon.png'),\n  shadowUrl: require('leaflet/dist/images/marker-shadow.png')\n});\n\nconst MapComponent = ({ \n  center = [20.5937, 78.9629], \n  zoom = 13,\n  markers = [],\n  routes = [],\n  onMapClick,\n  interactive = true,\n  className = ''\n}) => {\n  const mapRef = useRef(null);\n  const mapInstanceRef = useRef(null);\n  const markersRef = useRef([]);\n  const routesRef = useRef([]);\n  const { setMapInstance } = useMap();\n\n  // Initialize map\n  useEffect(() => {\n    if (!mapRef.current) return;\n\n    // Clean up existing map\n    if (mapInstanceRef.current) {\n      mapInstanceRef.current.remove();\n    }\n\n    // Create new map\n    const map = L.map(mapRef.current, {\n      center,\n      zoom,\n      zoomControl: false,\n      dragging: interactive,\n      scrollWheelZoom: interactive,\n      doubleClickZoom: interactive,\n      touchZoom: interactive\n    });\n\n    // Add tile layer\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n      attribution: '¬© OpenStreetMap contributors',\n      maxZoom: 19\n    }).addTo(map);\n\n    // Add click handler\n    if (onMapClick) {\n      map.on('click', onMapClick);\n    }\n\n    mapInstanceRef.current = map;\n    setMapInstance(map);\n\n    // Cleanup on unmount\n    return () => {\n      if (mapInstanceRef.current) {\n        mapInstanceRef.current.remove();\n        mapInstanceRef.current = null;\n      }\n    };\n  }, [center, zoom, interactive]);\n\n  // Update markers\n  useEffect(() => {\n    if (!mapInstanceRef.current) return;\n\n    // Clear existing markers\n    markersRef.current.forEach(marker => marker.remove());\n    markersRef.current = [];\n\n    // Add new markers\n    markers.forEach(markerData => {\n      if (!markerData.position || !markerData.position.lat || !markerData.position.lng) {\n        return;\n      }\n\n      let icon;\n      if (markerData.iconHtml) {\n        icon = L.divIcon({\n          html: markerData.iconHtml,\n          className: markerData.className || 'custom-marker',\n          iconSize: markerData.iconSize || [40, 40],\n          iconAnchor: markerData.iconAnchor || [20, 40]\n        });\n      } else {\n        const color = markerData.color || '#3498db';\n        const iconHtml = `\n          <div style=\"\n            width: ${markerData.size || 40}px;\n            height: ${markerData.size || 40}px;\n            background: ${color};\n            border-radius: 50%;\n            border: 3px solid white;\n            box-shadow: 0 2px 5px rgba(0,0,0,0.3);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: white;\n            font-size: ${markerData.iconSize || 16}px;\n          \">\n            ${markerData.icon || 'üìç'}\n          </div>\n        `;\n        icon = L.divIcon({\n          html: iconHtml,\n          className: '',\n          iconSize: [markerData.size || 40, markerData.size || 40],\n          iconAnchor: [(markerData.size || 40) / 2, (markerData.size || 40)]\n        });\n      }\n\n      const marker = L.marker([\n        markerData.position.lat,\n        markerData.position.lng\n      ], { icon }).addTo(mapInstanceRef.current);\n\n      if (markerData.popup) {\n        marker.bindPopup(markerData.popup);\n      }\n\n      if (markerData.onClick) {\n        marker.on('click', () => markerData.onClick(markerData));\n      }\n\n      markersRef.current.push(marker);\n    });\n\n    // Fit bounds if markers exist\n    if (markers.length > 0 && mapInstanceRef.current) {\n      const latLngs = markers\n        .filter(m => m.position?.lat && m.position?.lng)\n        .map(m => [m.position.lat, m.position.lng]);\n      \n      if (latLngs.length > 0) {\n        const bounds = L.latLngBounds(latLngs);\n        mapInstanceRef.current.fitBounds(bounds, { \n          padding: [50, 50],\n          maxZoom: 15\n        });\n      }\n    }\n  }, [markers]);\n\n  // Update routes\n  useEffect(() => {\n    if (!mapInstanceRef.current) return;\n\n    // Clear existing routes\n    routesRef.current.forEach(route => route.remove());\n    routesRef.current = [];\n\n    // Add new routes\n    routes.forEach(routeData => {\n      if (!routeData.coordinates || routeData.coordinates.length < 2) {\n        return;\n      }\n\n      const polyline = L.polyline(\n        routeData.coordinates.map(coord => [coord.lat, coord.lng]),\n        {\n          color: routeData.color || '#3498db',\n          weight: routeData.weight || 4,\n          opacity: routeData.opacity || 0.7,\n          dashArray: routeData.dashed ? '10, 10' : undefined\n        }\n      ).addTo(mapInstanceRef.current);\n\n      routesRef.current.push(polyline);\n    });\n  }, [routes]);\n\n  // Update map center when props change\n  useEffect(() => {\n    if (mapInstanceRef.current && center) {\n      mapInstanceRef.current.setView(center, zoom);\n    }\n  }, [center, zoom]);\n\n  return (\n    <div \n      ref={mapRef} \n      className={`w-full h-full ${className}`}\n      style={{ minHeight: '400px' }}\n    />\n  );\n};\n\nexport default MapComponent;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}