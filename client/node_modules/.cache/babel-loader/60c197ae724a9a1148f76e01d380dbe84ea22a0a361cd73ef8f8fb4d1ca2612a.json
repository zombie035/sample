{"ast":null,"code":"var _jsxFileName = \"/home/project/client/src/contexts/SocketContext.jsx\";\n// client/src/contexts/SocketContext.jsx\nimport React, { createContext, useContext, useEffect, useState } from 'react';\nimport io from 'socket.io-client';\nimport { useAuth } from './AuthContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SocketContext = /*#__PURE__*/createContext(null);\nexport const useSocket = () => useContext(SocketContext);\nexport const SocketProvider = ({\n  children\n}) => {\n  const [socket, setSocket] = useState(null);\n  const [connected, setConnected] = useState(false);\n  const {\n    user\n  } = useAuth();\n  useEffect(() => {\n    if (!user) return;\n    const newSocket = io(process.env.REACT_APP_API_URL || 'http://localhost:5000', {\n      withCredentials: true,\n      transports: ['websocket', 'polling']\n    });\n    newSocket.on('connect', () => {\n      console.log('Socket connected');\n      setConnected(true);\n\n      // Join appropriate room based on user role\n      if (user.role === 'driver') {\n        newSocket.emit('join-driver-room', user.id);\n      }\n    });\n    newSocket.on('disconnect', () => {\n      console.log('Socket disconnected');\n      setConnected(false);\n    });\n    newSocket.on('connect_error', error => {\n      console.error('Socket connection error:', error);\n    });\n    setSocket(newSocket);\n    return () => {\n      newSocket.disconnect();\n    };\n  }, [user]);\n  const joinBusRoom = busId => {\n    if (socket && busId) {\n      socket.emit('join-bus-room', busId);\n    }\n  };\n  const sendLocationUpdate = data => {\n    if (socket && connected) {\n      socket.emit('driver-location-update', data);\n    }\n  };\n  const value = {\n    socket,\n    connected,\n    joinBusRoom,\n    sendLocationUpdate\n  };\n  return /*#__PURE__*/_jsxDEV(SocketContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 69,\n    columnNumber: 5\n  }, this);\n};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","io","useAuth","jsxDEV","_jsxDEV","SocketContext","useSocket","SocketProvider","children","socket","setSocket","connected","setConnected","user","newSocket","process","env","REACT_APP_API_URL","withCredentials","transports","on","console","log","role","emit","id","error","disconnect","joinBusRoom","busId","sendLocationUpdate","data","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber"],"sources":["/home/project/client/src/contexts/SocketContext.jsx"],"sourcesContent":["// client/src/contexts/SocketContext.jsx\nimport React, { createContext, useContext, useEffect, useState } from 'react';\nimport io from 'socket.io-client';\nimport { useAuth } from './AuthContext';\n\nconst SocketContext = createContext(null);\n\nexport const useSocket = () => useContext(SocketContext);\n\nexport const SocketProvider = ({ children }) => {\n  const [socket, setSocket] = useState(null);\n  const [connected, setConnected] = useState(false);\n  const { user } = useAuth();\n\n  useEffect(() => {\n    if (!user) return;\n\n    const newSocket = io(process.env.REACT_APP_API_URL || 'http://localhost:5000', {\n      withCredentials: true,\n      transports: ['websocket', 'polling']\n    });\n\n    newSocket.on('connect', () => {\n      console.log('Socket connected');\n      setConnected(true);\n      \n      // Join appropriate room based on user role\n      if (user.role === 'driver') {\n        newSocket.emit('join-driver-room', user.id);\n      }\n    });\n\n    newSocket.on('disconnect', () => {\n      console.log('Socket disconnected');\n      setConnected(false);\n    });\n\n    newSocket.on('connect_error', (error) => {\n      console.error('Socket connection error:', error);\n    });\n\n    setSocket(newSocket);\n\n    return () => {\n      newSocket.disconnect();\n    };\n  }, [user]);\n\n  const joinBusRoom = (busId) => {\n    if (socket && busId) {\n      socket.emit('join-bus-room', busId);\n    }\n  };\n\n  const sendLocationUpdate = (data) => {\n    if (socket && connected) {\n      socket.emit('driver-location-update', data);\n    }\n  };\n\n  const value = {\n    socket,\n    connected,\n    joinBusRoom,\n    sendLocationUpdate\n  };\n\n  return (\n    <SocketContext.Provider value={value}>\n      {children}\n    </SocketContext.Provider>\n  );\n};"],"mappings":";AAAA;AACA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,UAAU,EAAEC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAC7E,OAAOC,EAAE,MAAM,kBAAkB;AACjC,SAASC,OAAO,QAAQ,eAAe;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAExC,MAAMC,aAAa,gBAAGR,aAAa,CAAC,IAAI,CAAC;AAEzC,OAAO,MAAMS,SAAS,GAAGA,CAAA,KAAMR,UAAU,CAACO,aAAa,CAAC;AAExD,OAAO,MAAME,cAAc,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAC9C,MAAM,CAACC,MAAM,EAAEC,SAAS,CAAC,GAAGV,QAAQ,CAAC,IAAI,CAAC;EAC1C,MAAM,CAACW,SAAS,EAAEC,YAAY,CAAC,GAAGZ,QAAQ,CAAC,KAAK,CAAC;EACjD,MAAM;IAAEa;EAAK,CAAC,GAAGX,OAAO,CAAC,CAAC;EAE1BH,SAAS,CAAC,MAAM;IACd,IAAI,CAACc,IAAI,EAAE;IAEX,MAAMC,SAAS,GAAGb,EAAE,CAACc,OAAO,CAACC,GAAG,CAACC,iBAAiB,IAAI,uBAAuB,EAAE;MAC7EC,eAAe,EAAE,IAAI;MACrBC,UAAU,EAAE,CAAC,WAAW,EAAE,SAAS;IACrC,CAAC,CAAC;IAEFL,SAAS,CAACM,EAAE,CAAC,SAAS,EAAE,MAAM;MAC5BC,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAC;MAC/BV,YAAY,CAAC,IAAI,CAAC;;MAElB;MACA,IAAIC,IAAI,CAACU,IAAI,KAAK,QAAQ,EAAE;QAC1BT,SAAS,CAACU,IAAI,CAAC,kBAAkB,EAAEX,IAAI,CAACY,EAAE,CAAC;MAC7C;IACF,CAAC,CAAC;IAEFX,SAAS,CAACM,EAAE,CAAC,YAAY,EAAE,MAAM;MAC/BC,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAC;MAClCV,YAAY,CAAC,KAAK,CAAC;IACrB,CAAC,CAAC;IAEFE,SAAS,CAACM,EAAE,CAAC,eAAe,EAAGM,KAAK,IAAK;MACvCL,OAAO,CAACK,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;IAClD,CAAC,CAAC;IAEFhB,SAAS,CAACI,SAAS,CAAC;IAEpB,OAAO,MAAM;MACXA,SAAS,CAACa,UAAU,CAAC,CAAC;IACxB,CAAC;EACH,CAAC,EAAE,CAACd,IAAI,CAAC,CAAC;EAEV,MAAMe,WAAW,GAAIC,KAAK,IAAK;IAC7B,IAAIpB,MAAM,IAAIoB,KAAK,EAAE;MACnBpB,MAAM,CAACe,IAAI,CAAC,eAAe,EAAEK,KAAK,CAAC;IACrC;EACF,CAAC;EAED,MAAMC,kBAAkB,GAAIC,IAAI,IAAK;IACnC,IAAItB,MAAM,IAAIE,SAAS,EAAE;MACvBF,MAAM,CAACe,IAAI,CAAC,wBAAwB,EAAEO,IAAI,CAAC;IAC7C;EACF,CAAC;EAED,MAAMC,KAAK,GAAG;IACZvB,MAAM;IACNE,SAAS;IACTiB,WAAW;IACXE;EACF,CAAC;EAED,oBACE1B,OAAA,CAACC,aAAa,CAAC4B,QAAQ;IAACD,KAAK,EAAEA,KAAM;IAAAxB,QAAA,EAClCA;EAAQ;IAAA0B,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACa,CAAC;AAE7B,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}