{"ast":null,"code":"// client/src/contexts/AuthContext.jsx\nimport React,{createContext,useState,useContext,useEffect}from'react';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext({});export const useAuth=()=>useContext(AuthContext);export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState('');// Check authentication status on mount\nuseEffect(()=>{checkAuth();},[]);const checkAuth=async()=>{try{const response=await axios.get('/api/auth/check',{withCredentials:true});if(response.data.authenticated){setUser(response.data.user);}}catch(error){console.error('Auth check failed:',error);}finally{setLoading(false);}};const login=async(email,password)=>{setError('');try{const response=await axios.post('/api/auth/login',{email,password},{withCredentials:true});if(response.data.success){setUser(response.data.user);return{success:true,role:response.data.user.role};}}catch(error){var _error$response,_error$response$data,_error$response2,_error$response2$data;setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Login failed');return{success:false,error:(_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message};}};const logout=async()=>{try{await axios.post('/api/auth/logout',{},{withCredentials:true});setUser(null);}catch(error){console.error('Logout failed:',error);}};const value={user,loading,error,login,logout,checkAuth,isAuthenticated:!!user,isAdmin:(user===null||user===void 0?void 0:user.role)==='admin',isDriver:(user===null||user===void 0?void 0:user.role)==='driver',isStudent:(user===null||user===void 0?void 0:user.role)==='student'};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","axios","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","user","setUser","loading","setLoading","error","setError","checkAuth","response","get","withCredentials","data","authenticated","console","login","email","password","post","success","role","_error$response","_error$response$data","_error$response2","_error$response2$data","message","logout","value","isAuthenticated","isAdmin","isDriver","isStudent","Provider"],"sources":["/home/project/client/src/contexts/AuthContext.jsx"],"sourcesContent":["// client/src/contexts/AuthContext.jsx\nimport React, { createContext, useState, useContext, useEffect } from 'react';\nimport axios from 'axios';\n\nconst AuthContext = createContext({});\n\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n\n  // Check authentication status on mount\n  useEffect(() => {\n    checkAuth();\n  }, []);\n\n  const checkAuth = async () => {\n    try {\n      const response = await axios.get('/api/auth/check', {\n        withCredentials: true\n      });\n      \n      if (response.data.authenticated) {\n        setUser(response.data.user);\n      }\n    } catch (error) {\n      console.error('Auth check failed:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const login = async (email, password) => {\n    setError('');\n    try {\n      const response = await axios.post('/api/auth/login', {\n        email,\n        password\n      }, {\n        withCredentials: true\n      });\n\n      if (response.data.success) {\n        setUser(response.data.user);\n        return { success: true, role: response.data.user.role };\n      }\n    } catch (error) {\n      setError(error.response?.data?.message || 'Login failed');\n      return { success: false, error: error.response?.data?.message };\n    }\n  };\n\n  const logout = async () => {\n    try {\n      await axios.post('/api/auth/logout', {}, {\n        withCredentials: true\n      });\n      setUser(null);\n    } catch (error) {\n      console.error('Logout failed:', error);\n    }\n  };\n\n  const value = {\n    user,\n    loading,\n    error,\n    login,\n    logout,\n    checkAuth,\n    isAuthenticated: !!user,\n    isAdmin: user?.role === 'admin',\n    isDriver: user?.role === 'driver',\n    isStudent: user?.role === 'student'\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}